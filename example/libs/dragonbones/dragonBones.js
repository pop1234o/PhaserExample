(function(){var i,s,t,e,a,r,n,o,l,h,u,_,f,m,c,p,d,y,g,D,v,b,T,A,P,S,x,O,M,w,I,E,B,C,F,R,N,k,j,L,U,Y,X,V,G,H,W,z,K,Z,q,Q,J,$,tt,et,at,it,rt,nt,st=this,ot=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)});return it||(it={}),s=it||(it={}),t=function(){function e(t){this._clock=new s.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=t,console.info("@AILab DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demos: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(t){if(0<this._objects.length){for(var e=0,a=this._objects;e<a.length;e++){a[e].returnToPool()}this._objects.length=0}if(this._clock.advanceTime(t),0<this._events.length){for(var i=0;i<this._events.length;++i){var r=this._events[i],n=r.armature;null!==n._armatureData&&(n.eventDispatcher.dispatchDBEvent(r.type,r),r.type===s.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(r.type,r)),this.bufferObject(r)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="1.0.4",e.yDown=!0,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e}(),s.DragonBones=t,console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),e=it||(it={}),a=function(){function n(){this.hashCode=n._hashCode++,this._isInPool=!1}return n._returnObject=function(t){var e=String(t.constructor),a=e in n._maxCountMap?n._maxCountMap[e]:n._defaultMaxCount,i=n._poolsMap[e]=n._poolsMap[e]||[];i.length<a&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,i.push(t)))},n.toString=function(){throw new Error},n.setMaxCount=function(t,e){if((e<0||e!=e)&&(e=0),null!==t)null!==(i=(a=String(t))in n._poolsMap?n._poolsMap[a]:null)&&i.length>e&&(i.length=e),n._maxCountMap[a]=e;else for(var a in n._defaultMaxCount=e,n._poolsMap){var i;(i=n._poolsMap[a]).length>e&&(i.length=e),a in n._maxCountMap&&(n._maxCountMap[a]=e)}},n.clearPool=function(t){if(void 0===t&&(t=null),null!==t){var e=String(t);null!==(i=e in n._poolsMap?n._poolsMap[e]:null)&&0<i.length&&(i.length=0)}else for(var a in n._poolsMap){var i;(i=n._poolsMap[a]).length=0}},n.borrowObject=function(t){var e=String(t),a=e in n._poolsMap?n._poolsMap[e]:null;if(null!==a&&0<a.length){var i=a.pop();return i._isInPool=!1,i}var r=new t;return r._onClear(),r},n.prototype.returnToPool=function(){this._onClear(),n._returnObject(this)},n._hashCode=0,n._defaultMaxCount=3e3,n._maxCountMap={},n._poolsMap={},n}(),e.BaseObject=a,r=it||(it={}),n=function(){function t(t,e,a,i,r,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===n&&(n=0),this.a=t,this.b=e,this.c=a,this.d=i,this.tx=r,this.ty=n}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,a=0,i=0,r=this.d*t.d,n=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,a+=this.b*t.d,i+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(a+=this.a*t.b,i+=this.d*t.c,n+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=a,this.c=i,this.d=r,this.tx=n,this.ty=s,this},t.prototype.invert=function(){var t=this.a,e=this.b,a=this.c,i=this.d,r=this.tx,n=this.ty;if(0===e&&0===a)return this.b=this.c=0,0===t||0===i?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,i=this.d=1/i,this.tx=-t*r,this.ty=-i*n),this;var s=t*i-e*a;if(0===s)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;s=1/s;var o=this.a=i*s;return e=this.b=-e*s,a=this.c=-a*s,i=this.d=t*s,this.tx=-(o*r+a*n),this.ty=-(e*r+i*n),this},t.prototype.transformPoint=function(t,e,a,i){void 0===i&&(i=!1),a.x=this.a*t+this.c*e,a.y=this.b*t+this.d*e,i||(a.x+=this.tx,a.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var a=this.a,i=this.b,r=this.c,n=this.d,s=e?0:this.tx,o=e?0:this.ty,l=t.x,h=t.y,u=l+t.width,_=h+t.height,f=a*l+r*h+s,m=i*l+n*h+o,c=a*u+r*h+s,p=i*u+n*h+o,d=a*u+r*_+s,y=i*u+n*_+o,g=a*l+r*_+s,D=i*l+n*_+o,v=0;c<f&&(v=f,f=c,c=v),g<d&&(v=d,d=g,g=v),t.x=Math.floor(f<d?f:d),t.width=Math.ceil((g<c?c:g)-t.x),p<m&&(v=m,m=p,p=v),D<y&&(v=y,y=D,D=v),t.y=Math.floor(m<y?m:y),t.height=Math.ceil((D<p?p:D)-t.y)},t}(),r.Matrix=n,o=it||(it={}),l=function(){function n(t,e,a,i,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),this.x=t,this.y=e,this.skew=a,this.rotation=i,this.scaleX=r,this.scaleY=n}return n.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=0<t?-Math.PI:Math.PI},n.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},n.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},n.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},n.prototype.fromMatrix=function(t){var e=this.scaleX,a=this.scaleY,i=n.PI_Q;this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a);var r=Math.atan(-t.c/t.d);return this.scaleX=this.rotation>-i&&this.rotation<i?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=-i<r&&r<i?t.d/Math.cos(r):-t.c/Math.sin(r),0<=e&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),0<=a&&this.scaleY<0&&(this.scaleY=-this.scaleY,r-=Math.PI),this.skew=r-this.rotation,this},n.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},n.PI=Math.PI,n.PI_D=2*Math.PI,n.PI_H=Math.PI/2,n.PI_Q=Math.PI/4,n.RAD_DEG=180/Math.PI,n.DEG_RAD=Math.PI/180,n}(),o.Transform=l,h=it||(it={}),u=function(){function t(t,e,a,i,r,n,s,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===a&&(a=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=a,this.blueMultiplier=i,this.alphaOffset=r,this.redOffset=n,this.greenOffset=s,this.blueOffset=o}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}(),h.ColorTransform=u,_=it||(it={}),f=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}(),_.Point=f,m=it||(it={}),c=function(){function t(t,e,a,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=a,this.height=i}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}(),m.Rectangle=c,function(t){var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ints=[],t.floats=[],t.strings=[],t}return ot(t,e),t.toString=function(){return"[class dragonBones.UserData]"},t.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},t.prototype.addInt=function(t){this.ints.push(t)},t.prototype.addFloat=function(t){this.floats.push(t)},t.prototype.addString=function(t){this.strings.push(t)},t.prototype.getInt=function(t){return void 0===t&&(t=0),0<=t&&t<this.ints.length?this.ints[t]:0},t.prototype.getFloat=function(t){return void 0===t&&(t=0),0<=t&&t<this.floats.length?this.floats[t]:0},t.prototype.getString=function(t){return void 0===t&&(t=0),0<=t&&t<this.strings.length?this.strings[t]:""},t}(t.BaseObject);t.UserData=e;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.ActionData]"},t.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},t}(t.BaseObject);t.ActionData=a}(it||(it={})),p=it||(it={}),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frameIndices=[],t.cachedFrames=[],t.armatureNames=[],t.armatures={},t.userData=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.DragonBonesData]"},t.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},t.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):((t.parent=this).armatures[t.name]=t,this.armatureNames.push(t.name))},t.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},t.prototype.dispose=function(){console.warn("已废弃"),this.returnToPool()},t}(p.BaseObject),p.DragonBonesData=d,function(a){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aabb=new a.Rectangle,t.animationNames=[],t.sortedBones=[],t.sortedSlots=[],t.defaultActions=[],t.actions=[],t.bones={},t.slots={},t.constraints={},t.skins={},t.animations={},t.canvas=null,t.userData=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.ArmatureData]"},t.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){e[t].returnToPool()}for(var a=0,i=this.actions;a<i.length;a++){i[a].returnToPool()}for(var r in this.bones)this.bones[r].returnToPool(),delete this.bones[r];for(var r in this.slots)this.slots[r].returnToPool(),delete this.slots[r];for(var r in this.constraints)this.constraints[r].returnToPool(),delete this.constraints[r];for(var r in this.skins)this.skins[r].returnToPool(),delete this.skins[r];for(var r in this.animations)this.animations[r].returnToPool(),delete this.animations[r];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},t.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),a=0,i=0;for(this.sortedBones.length=0;i<t;){var r=e[a++];if(t<=a&&(a=0),!(0<=this.sortedBones.indexOf(r))){var n=!1;for(var s in this.constraints){var o=this.constraints[s];if(o.root===r&&this.sortedBones.indexOf(o.target)<0){n=!0;break}}n||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),i++)}}}},t.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},t.prototype.setCacheFrame=function(t,e){var a=this.parent.cachedFrames,i=a.length;return a.length+=10,a[i]=t.a,a[i+1]=t.b,a[i+2]=t.c,a[i+3]=t.d,a[i+4]=t.tx,a[i+5]=t.ty,a[i+6]=e.rotation,a[i+7]=e.skew,a[i+8]=e.scaleX,a[i+9]=e.scaleY,i},t.prototype.getCacheFrame=function(t,e,a){var i=this.parent.cachedFrames;t.a=i[a],t.b=i[a+1],t.c=i[a+2],t.d=i[a+3],t.tx=i[a+4],t.ty=i[a+5],e.rotation=i[a+6],e.skew=i[a+7],e.scaleX=i[a+8],e.scaleY=i[a+9],e.x=t.tx,e.y=t.ty},t.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},t.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},t.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},t.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):((t.parent=this).skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},t.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):((t.parent=this).animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},t.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},t.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},t.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},t.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},t.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},t.prototype.getMesh=function(t,e,a){var i=this.getSkin(t);return null===i?null:i.getDisplay(e,a)},t.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},t}(a.BaseObject);a.ArmatureData=t;var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transform=new a.Transform,t.userData=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.BoneData]"},t.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},t}(a.BaseObject),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertices=[],t}return ot(t,e),t.toString=function(){return"[class dragonBones.SurfaceData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0},t}(a.BoneData=e);a.SurfaceData=i;var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return ot(t,e),t.createColor=function(){return new a.ColorTransform},t.toString=function(){return"[class dragonBones.SlotData]"},t.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},t.DEFAULT_COLOR=new a.ColorTransform,t}(a.BaseObject);a.SlotData=r}(it||(it={})),y=it||(it={}),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(y.BaseObject),y.CanvasData=g,D=it||(it={}),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displays={},t}return ot(t,e),t.toString=function(){return"[class dragonBones.SkinData]"},t.prototype._onClear=function(){for(var t in this.displays){for(var e=0,a=this.displays[t];e<a.length;e++){var i=a[e];null!==i&&i.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},t.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},t.prototype.getDisplay=function(t,e){var a=this.getDisplays(t);if(null!==a)for(var i=0,r=a;i<r.length;i++){var n=r[i];if(null!==n&&n.name===e)return n}return null},t.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},t}(D.BaseObject),D.SkinData=v,b=it||(it={}),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.target=null,this.root=null,this.bone=null},e}(b.BaseObject),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(b.ConstraintData=T),b.IKConstraintData=A,function(a){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transform=new a.Transform,t}return ot(t,e),t.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},t}(a.BaseObject),e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pivot=new a.Point,t}return ot(t,e),t.toString=function(){return"[class dragonBones.ImageDisplayData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},t}(a.DisplayData=t);a.ImageDisplayData=e;var i=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.actions=[],t}return ot(t,a),t.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},t.prototype._onClear=function(){a.prototype._onClear.call(this);for(var t=0,e=this.actions;t<e.length;t++){e[t].returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},t.prototype.addAction=function(t){this.actions.push(t)},t}(t);a.ArmatureDisplayData=i;var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.weight=null,t.glue=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.MeshDisplayData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.weight&&this.weight.returnToPool(),null!==this.glue&&this.glue.returnToPool(),this.type=2,this.inheritDeform=!1,this.offset=0,this.weight=null,this.glue=null,this.texture=null},t}(t);a.MeshDisplayData=r;var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boundingBox=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},t}(t);a.BoundingBoxDisplayData=n;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bones=[],t}return ot(t,e),t.toString=function(){return"[class dragonBones.WeightData]"},t.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},t.prototype.addBone=function(t){this.bones.push(t)},t}(a.BaseObject);a.WeightData=s;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.meshes=[],t}return ot(t,e),t.toString=function(){return"[class dragonBones.GlueData]"},t.prototype._onClear=function(){this.weights.length=0,this.meshes.length=0},t.prototype.addMesh=function(t){this.meshes.push(t)},t}(a.BaseObject);a.GlueData=o}(it||(it={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject),h=function(t){function v(){return null!==t&&t.apply(this,arguments)||this}return ot(v,t),v.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},v._computeOutCode=function(t,e,a,i,r,n){var s=0;return t<a?s|=1:r<t&&(s|=2),e<i?s|=4:n<e&&(s|=8),s},v.rectangleIntersectsSegment=function(t,e,a,i,r,n,s,o,l,h,u){void 0===l&&(l=null),void 0===h&&(h=null),void 0===u&&(u=null);var _=r<t&&t<s&&n<e&&e<o,f=r<a&&a<s&&n<i&&i<o;if(_&&f)return-1;for(var m=0,c=v._computeOutCode(t,e,r,n,s,o),p=v._computeOutCode(a,i,r,n,s,o);;){if(0==(c|p)){m=2;break}if(0!=(c&p))break;var d=0,y=0,g=0,D=0!==c?c:p;0!=(4&D)?(d=t+(a-t)*(n-e)/(i-e),y=n,null!==u&&(g=.5*-Math.PI)):0!=(8&D)?(d=t+(a-t)*(o-e)/(i-e),y=o,null!==u&&(g=.5*Math.PI)):0!=(2&D)?(y=e+(i-e)*(s-t)/(a-t),d=s,null!==u&&(g=0)):0!=(1&D)&&(y=e+(i-e)*(r-t)/(a-t),d=r,null!==u&&(g=Math.PI)),D===c?(c=v._computeOutCode(t=d,e=y,r,n,s,o),null!==u&&(u.x=g)):(p=v._computeOutCode(a=d,i=y,r,n,s,o),null!==u&&(u.y=g))}return m&&(_?(m=2,null!==l&&(l.x=a,l.y=i),null!==h&&(h.x=a,h.y=a),null!==u&&(u.x=u.y+Math.PI)):f?(m=1,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=t,h.y=e),null!==u&&(u.y=u.x+Math.PI)):(m=3,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=a,h.y=i))),m},v.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},v.prototype.containsPoint=function(t,e){var a=.5*this.width;if(-a<=t&&t<=a){var i=.5*this.height;if(-i<=e&&e<=i)return!0}return!1},v.prototype.intersectsSegment=function(t,e,a,i,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null);var o=.5*this.width,l=.5*this.height;return v.rectangleIntersectsSegment(t,e,a,i,-o,-l,o,l,r,n,s)},v}(t.BoundingBoxData=e);t.RectangleBoundingBoxData=h;var a=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return ot(o,t),o.toString=function(){return"[class dragonBones.EllipseData]"},o.ellipseIntersectsSegment=function(t,e,a,i,r,n,s,o,l,h,u){void 0===l&&(l=null),void 0===h&&(h=null),void 0===u&&(u=null);var _=s/o,f=_*_,m=a-t,c=(i*=_)-(e*=_),p=Math.sqrt(m*m+c*c),d=m/p,y=c/p,g=(r-t)*d+(n-e)*y,D=s*s,v=D-(t*t+e*e)+g*g,b=0;if(0<=v){var T=Math.sqrt(v),A=g-T,P=g+T,S=A<0?-1:A<=p?0:1,x=P<0?-1:P<=p?0:1,O=S*x;if(O<0)return-1;0===O&&(-1===S?(b=2,a=t+P*d,i=(e+P*y)/_,null!==l&&(l.x=a,l.y=i),null!==h&&(h.x=a,h.y=i),null!==u&&(u.x=Math.atan2(i/D*f,a/D),u.y=u.x+Math.PI)):1===x?(b=1,t+=A*d,e=(e+A*y)/_,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=t,h.y=e),null!==u&&(u.x=Math.atan2(e/D*f,t/D),u.y=u.x+Math.PI)):(b=3,null!==l&&(l.x=t+A*d,l.y=(e+A*y)/_,null!==u&&(u.x=Math.atan2(l.y/D*f,l.x/D))),null!==h&&(h.x=t+P*d,h.y=(e+P*y)/_,null!==u&&(u.y=Math.atan2(h.y/D*f,h.x/D)))))}return b},o.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},o.prototype.containsPoint=function(t,e){var a=.5*this.width;if(-a<=t&&t<=a){var i=.5*this.height;if(-i<=e&&e<=i)return e*=a/i,Math.sqrt(t*t+e*e)<=a}return!1},o.prototype.intersectsSegment=function(t,e,a,i,r,n,s){return void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null),o.ellipseIntersectsSegment(t,e,a,i,0,0,.5*this.width,.5*this.height,r,n,s)},o}(e);t.EllipseBoundingBoxData=a;var i=function(e){function l(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertices=[],t.weight=null,t}return ot(l,e),l.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},l.polygonIntersectsSegment=function(t,e,a,i,r,n,s,o){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null),t===a&&(t=a+1e-6),e===i&&(e=i+1e-6);for(var l=r.length,h=t-a,u=e-i,_=t*i-e*a,f=0,m=r[l-2],c=r[l-1],p=0,d=0,y=0,g=0,D=0,v=0,b=0;b<l;b+=2){var T=r[b],A=r[b+1];m===T&&(m=T+1e-4),c===A&&(c=A+1e-4);var P=m-T,S=c-A,x=m*A-c*T,O=h*S-u*P,M=(_*P-h*x)/O;if((m<=M&&M<=T||T<=M&&M<=m)&&(0===h||t<=M&&M<=a||a<=M&&M<=t)){var w=(_*S-u*x)/O;if((c<=w&&w<=A||A<=w&&w<=c)&&(0===u||e<=w&&w<=i||i<=w&&w<=e)){if(null===s){D=y=M,v=g=w,f++,null!==o&&(o.x=Math.atan2(A-c,T-m)-.5*Math.PI,o.y=o.x);break}var I=M-t;I<0&&(I=-I),0===f?(d=p=I,D=y=M,v=g=w,null!==o&&(o.x=Math.atan2(A-c,T-m)-.5*Math.PI,o.y=o.x)):(I<p&&(p=I,y=M,g=w,null!==o&&(o.x=Math.atan2(A-c,T-m)-.5*Math.PI)),d<I&&(d=I,D=M,v=w,null!==o&&(o.y=Math.atan2(A-c,T-m)-.5*Math.PI))),f++}}m=T,c=A}return 1===f?(null!==n&&(n.x=y,n.y=g),null!==s&&(s.x=y,s.y=g),null!==o&&(o.y=o.x+Math.PI)):1<f&&(f++,null!==n&&(n.x=y,n.y=g),null!==s&&(s.x=D,s.y=v)),f},l.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.weight&&this.weight.returnToPool(),this.type=2,this.x=0,this.y=0,this.vertices.length=0,this.weight=null},l.prototype.containsPoint=function(t,e){var a=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var i=0,r=this.vertices.length,n=r-2;i<r;i+=2){var s=this.vertices[n+1],o=this.vertices[i+1];if(o<e&&e<=s||s<e&&e<=o){var l=this.vertices[n],h=this.vertices[i];(e-o)*(l-h)/(s-o)+h<t&&(a=!a)}n=i}return a},l.prototype.intersectsSegment=function(t,e,a,i,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null);var o=0;return 0!==h.rectangleIntersectsSegment(t,e,a,i,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(o=l.polygonIntersectsSegment(t,e,a,i,this.vertices,r,n,s)),o},l}(e);t.PolygonBoundingBoxData=i}(it||(it={})),function(t){var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cachedFrames=[],t.boneTimelines={},t.surfaceTimelines={},t.slotTimelines={},t.constraintTimelines={},t.animationTimelines={},t.boneCachedFrameIndices={},t.slotCachedFrameIndices={},t.actionTimeline=null,t.zOrderTimeline=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.AnimationData]"},t.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,a=this.boneTimelines[t];e<a.length;e++){a[e].returnToPool()}delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var i=0,r=this.surfaceTimelines[t];i<r.length;i++){r[i].returnToPool()}delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var n=0,s=this.slotTimelines[t];n<s.length;n++){s[n].returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var o=0,l=this.constraintTimelines[t];o<l.length;o++){l[o].returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var h=0,u=this.animationTimelines[t];h<u.length;h++){u[h].returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},t.prototype.cacheFrames=function(t){if(!(0<this.cacheFrameRate)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var a=0,i=this.cacheFrames.length;a<i;++a)this.cachedFrames[a]=!1;for(var r=0,n=this.parent.sortedBones;r<n.length;r++){var s=n[r];for(a=0,i=(h=new Array(e)).length;a<i;++a)h[a]=-1;this.boneCachedFrameIndices[s.name]=h}for(var o=0,l=this.parent.sortedSlots;o<l.length;o++){var h,u=l[o];for(a=0,i=(h=new Array(e)).length;a<i;++a)h[a]=-1;this.slotCachedFrameIndices[u.name]=h}}},t.prototype.addBoneTimeline=function(t,e){var a=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];a.indexOf(e)<0&&a.push(e)},t.prototype.addSurfaceTimeline=function(t,e){var a=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];a.indexOf(e)<0&&a.push(e)},t.prototype.addSlotTimeline=function(t,e){var a=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];a.indexOf(e)<0&&a.push(e)},t.prototype.addConstraintTimeline=function(t,e){var a=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];a.indexOf(e)<0&&a.push(e)},t.prototype.addAnimationTimeline=function(t,e){var a=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];a.indexOf(e)<0&&a.push(e)},t.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},t.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},t.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},t.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},t.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},t.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},t.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},t}(t.BaseObject);t.AnimationData=e;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=a}(it||(it={})),P=it||(it={}),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boneMask=[],t}return ot(t,e),t.toString=function(){return"[class dragonBones.AnimationConfig]"},t.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},t.prototype.clear=function(){this._onClear()},t.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,a=this.boneMask.length;e<a;++e)this.boneMask[e]=t.boneMask[e]},t.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||0<=this.boneMask.indexOf(t)},t.prototype.addBoneMask=function(t,e,a){void 0===a&&(a=!0);var i=t.getBone(e);if(null!==i&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),a))for(var r=0,n=t.getBones();r<n.length;r++){var s=n[r];this.boneMask.indexOf(s.name)<0&&i.contains(s)&&this.boneMask.push(s.name)}},t.prototype.removeBoneMask=function(t,e,a){void 0===a&&(a=!0);var i=this.boneMask.indexOf(e);if(0<=i&&this.boneMask.splice(i,1),a){var r=t.getBone(e);if(null!==r)if(0<this.boneMask.length)for(var n=0,s=t.getBones();n<s.length;n++){var o=s[n],l=this.boneMask.indexOf(o.name);0<=l&&r.contains(o)&&this.boneMask.splice(l,1)}else for(var h=0,u=t.getBones();h<u.length;h++){(o=u[h])!==r&&(r.contains(o)||this.boneMask.push(o.name))}}},t}(P.BaseObject),P.AnimationConfig=S,function(i){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textures={},t}return ot(t,e),t.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},t.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var a=this.createTexture();a.copyFrom(t.textures[e]),this.textures[e]=a}},t.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this).textures[t.name]=t},t.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},t}(i.BaseObject);i.TextureAtlasData=t;var e=function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.region=new i.Rectangle,t.frame=null,t}return ot(a,e),a.createRectangle=function(){return new i.Rectangle},a.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},a.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=a.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},a}(i.BaseObject);i.TextureData=e}(it||(it={})),x=it||(it={}),O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._glueSlots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.Armature]"},t._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},t.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++){e[t].returnToPool()}for(var a=0,i=this._slots;a<i.length;a++){i[a].returnToPool()}for(var r=0,n=this._constraints;r<n.length;r++){n[r].returnToPool()}null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._bonesDirty=!1,this._slotsDirty=!1,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._glueSlots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},t.prototype._sortBones=function(){var t=this._bones.length;if(!(t<=0)){var e=this._bones.concat(),a=0,i=0;for(this._bones.length=0;i<t;){var r=e[a++];if(t<=a&&(a=0),!(0<=this._bones.indexOf(r))){if(r._hasConstraint){for(var n=!1,s=0,o=this._constraints;s<o.length;s++){var l=o[s];if(l._root===r&&this._bones.indexOf(l._target)<0){n=!0;break}}if(n)continue}null!==r.parent&&this._bones.indexOf(r.parent)<0||(this._bones.push(r),i++)}}}},t.prototype._sortSlots=function(){this._slots.sort(t._onSortSlots)},t.prototype._sortZOrder=function(t,e){var a=this._armatureData.sortedSlots,i=null===t;if(this._zOrderDirty||!i){for(var r=0,n=a.length;r<n;++r){var s=i?r:t[e+r];if(!(s<0||n<=s)){var o=a[s],l=this.getSlot(o.name);null!==l&&l._setZorder(r)}}this._slotsDirty=!0,this._zOrderDirty=!i}},t.prototype._addBoneToBoneList=function(t){this._bones.indexOf(t)<0&&(this._bonesDirty=!0,this._bones.push(t))},t.prototype._removeBoneFromBoneList=function(t){var e=this._bones.indexOf(t);0<=e&&this._bones.splice(e,1)},t.prototype._addSlotToSlotList=function(t){this._slots.indexOf(t)<0&&(this._slotsDirty=!0,this._slots.push(t))},t.prototype._removeSlotFromSlotList=function(t){var e=this._slots.indexOf(t);0<=e&&this._slots.splice(e,1)},t.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},t.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},t.prototype.init=function(t,e,a,i){null===this._armatureData&&(this._armatureData=t,this._animation=x.BaseObject.borrowObject(x.Animation),this._proxy=e,this._display=a,this._dragonBones=i,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},t.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._bonesDirty&&(this._bonesDirty=!1,this._sortBones()),this._slotsDirty&&(this._slotsDirty=!1,this._sortSlots()),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){var a=0,i=0;for(a=0,i=this._bones.length;a<i;++a)this._bones[a].update(this._cacheFrameIndex);for(a=0,i=this._slots.length;a<i;++a)this._slots[a].update(this._cacheFrameIndex);for(a=0,i=this._glueSlots.length;a<i;++a)this._glueSlots[a]._updateGlueMesh()}if(0<this._actions.length){this._lockUpdate=!0;for(var r=0,n=this._actions;r<n.length;r++){var s=n[r];0===s.type&&this._animation.fadeIn(s.name)}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},t.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&0<t.length){if(null!==(s=this.getBone(t))&&(s.invalidUpdate(),e))for(var a=0,i=this._slots;a<i.length;a++){(h=i[a]).parent===s&&h.invalidUpdate()}}else{for(var r=0,n=this._bones;r<n.length;r++){var s;(s=n[r]).invalidUpdate()}if(e)for(var o=0,l=this._slots;o<l.length;o++){var h;(h=l[o]).invalidUpdate()}}},t.prototype.containsPoint=function(t,e){for(var a=0,i=this._slots;a<i.length;a++){var r=i[a];if(r.containsPoint(t,e))return r}return null},t.prototype.intersectsSegment=function(t,e,a,i,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null);for(var o=t===a,l=0,h=0,u=0,_=0,f=0,m=0,c=0,p=0,d=null,y=null,g=0,D=this._slots;g<D.length;g++){var v=D[g];if(0<v.intersectsSegment(t,e,a,i,r,n,s)){if(null===r&&null===n){d=v;break}var b;null!==r&&((b=o?r.y-e:r.x-t)<0&&(b=-b),(null===d||b<l)&&(l=b,u=r.x,_=r.y,d=v,s&&(c=s.x))),null!==n&&((b=n.x-t)<0&&(b=-b),(null===y||h<b)&&(h=b,f=n.x,m=n.y,y=v,null!==s&&(p=s.y)))}}return null!==d&&null!==r&&(r.x=u,r.y=_,null!==s&&(s.x=c)),null!==y&&null!==n&&(n.x=f,n.y=m,null!==s&&(s.y=p)),d},t.prototype.getBone=function(t){for(var e=0,a=this._bones;e<a.length;e++){var i=a[e];if(i.name===t)return i}return null},t.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},t.prototype.getSlot=function(t){for(var e=0,a=this._slots;e<a.length;e++){var i=a[e];if(i.name===t)return i}return null},t.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,a=this._slots;e<a.length;e++){var i=a[e];if(i.display===t)return i}return null},t.prototype.addBone=function(t,e){console.assert(null!==t),t._setArmature(this),t._setParent(0<e.length?this.getBone(e):null)},t.prototype.addSlot=function(t,e){var a=this.getBone(e);console.assert(null!==t&&null!==a),t._setArmature(this),t._setParent(a)},t.prototype.addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},t.prototype.removeBone=function(t){console.assert(null!==t&&t.armature===this),t._setParent(null),t._setArmature(null)},t.prototype.removeSlot=function(t){console.assert(null!==t&&t.armature===this),t._setParent(null),t._setArmature(null)},t.prototype.getBones=function(){return this._bones},t.prototype.getSlots=function(){return this._slots},Object.defineProperty(t.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,a=this._slots;e<a.length;e++){var i=a[e].childArmature;null!==i&&(i.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,a=this._slots;e<a.length;e++){var i=a[e];i.invalidUpdate(),i.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,a=this._slots;e<a.length;e++){var i=a[e].childArmature;null!==i&&(i.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t.prototype.replaceTexture=function(t){this.replacedTexture=t},t.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},t.prototype.addEventListener=function(t,e,a){this._proxy.addDBEventListener(t,e,a)},t.prototype.removeEventListener=function(t,e,a){this._proxy.removeDBEventListener(t,e,a)},t.prototype.enableAnimationCache=function(t){this.cacheFrameRate=t},t.prototype.getDisplay=function(){return this._display},t}(x.BaseObject),x.Armature=O,M=it||(it={}),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.globalTransformMatrix=new M.Matrix,t.global=new M.Transform,t.offset=new M.Transform,t}return ot(t,e),t.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null,this._parent=null},t.prototype._setArmature=function(t){this._armature=t},t.prototype._setParent=function(t){this._parent=t},t.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t._helpMatrix=new M.Matrix,t._helpTransform=new M.Transform,t._helpPoint=new M.Point,t}(M.BaseObject),M.TransformObject=w,I=it||(it={}),E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.animationPose=new I.Transform,t._blendState=new I.BlendState,t}return ot(t,e),t.toString=function(){return"[class dragonBones.Bone]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._cachedFrameIndices=null},t.prototype._updateGlobalTransformMatrix=function(t){var e=this._boneData,a=this._parent,i=this._armature.flipX,r=this._armature.flipY===I.DragonBones.yDown,n=null!==a,s=0,o=this.global,l=this.globalTransformMatrix;if(1===this.offsetMode?null!==this.origin?(o.x=this.origin.x+this.offset.x+this.animationPose.x,o.y=this.origin.y+this.offset.y+this.animationPose.y,o.skew=this.origin.skew+this.offset.skew+this.animationPose.skew,o.rotation=this.origin.rotation+this.offset.rotation+this.animationPose.rotation,o.scaleX=this.origin.scaleX*this.offset.scaleX*this.animationPose.scaleX,o.scaleY=this.origin.scaleY*this.offset.scaleY*this.animationPose.scaleY):o.copyFrom(this.offset).add(this.animationPose):0===this.offsetMode?null!==this.origin?o.copyFrom(this.origin).add(this.animationPose):o.copyFrom(this.animationPose):(n=!1,o.copyFrom(this.offset)),n){var h=0===a._boneData.type?a.globalTransformMatrix:a._getGlobalTransformMatrix(o.x,o.y);if(e.inheritScale)e.inheritRotation||(a.updateGlobalTransform(),s=i&&r?o.rotation-(a.global.rotation+Math.PI):i?o.rotation+a.global.rotation+Math.PI:r?o.rotation+a.global.rotation:o.rotation-a.global.rotation,o.rotation=s),o.toMatrix(l),l.concat(h),e.inheritTranslation?(o.x=l.tx,o.y=l.ty):(l.tx=o.x,l.ty=o.y),t?o.fromMatrix(l):this._globalDirty=!0;else{if(e.inheritTranslation){var u=o.x,_=o.y;o.x=h.a*u+h.c*_+h.tx,o.y=h.b*u+h.d*_+h.ty}else i&&(o.x=-o.x),r&&(o.y=-o.y);e.inheritRotation?(a.updateGlobalTransform(),s=a.global.scaleX<0?o.rotation+a.global.rotation+Math.PI:o.rotation+a.global.rotation,h.a*h.d-h.b*h.c<0&&(s-=2*o.rotation,(i!==r||e.inheritReflection)&&(o.skew+=Math.PI)),o.rotation=s):(i||r)&&(i&&r?s=o.rotation+Math.PI:(s=i?Math.PI-o.rotation:-o.rotation,o.skew+=Math.PI),o.rotation=s),o.toMatrix(l)}}else(i||r)&&(i&&(o.x=-o.x),r&&(o.y=-o.y),i&&r?s=o.rotation+Math.PI:(s=i?Math.PI-o.rotation:-o.rotation,o.skew+=Math.PI),o.rotation=s),o.toMatrix(l)},t.prototype._setArmature=function(t){if(this._armature!==t){var e=null,a=null;if(null!==this._armature&&(e=this.getSlots(),a=this.getBones(),this._armature._removeBoneFromBoneList(this)),this._armature=t,null!==this._armature&&this._armature._addBoneToBoneList(this),null!==e)for(var i=0,r=e;i<r.length;i++){var n=r[i];n.parent===this&&n._setArmature(this._armature)}if(null!==a)for(var s=0,o=a;s<o.length;s++){var l=o[s];l.parent===this&&l._setArmature(this._armature)}}},t.prototype.init=function(t){null===this._boneData&&(this._boneData=t,this.origin=this._boneData.transform)},t.prototype.update=function(t){if(this._blendState.dirty=!1,0<=t&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(0<=e&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(0<=e)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var a=0,i=this._armature._constraints;a<i.length;a++){(s=i[a])._root===this&&s.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){var s;(s=n[r])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var o=0<=t;this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},t.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},t.prototype.invalidUpdate=function(){this._transformDirty=!0},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(t.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,a=this._armature.getSlots();e<a.length;e++){var i=a[e];i._parent===this&&i._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),t.prototype.getBones=function(){for(var t=new Array,e=0,a=this._armature.getBones();e<a.length;e++){var i=a[e];i.parent===this&&t.push(i)}return t},t.prototype.getSlots=function(){for(var t=new Array,e=0,a=this._armature.getSlots();e<a.length;e++){var i=a[e];i.parent===this&&t.push(i)}return t},Object.defineProperty(t.prototype,"slot",{get:function(){for(var t=0,e=this._armature.getSlots();t<e.length;t++){var a=e[t];if(a.parent===this)return a}return null},enumerable:!0,configurable:!0}),t}(I.TransformObject),I.Bone=E,B=it||(it={}),C=function(n){function P(){var t=null!==n&&n.apply(this,arguments)||this;return t._vertices=[],t._deformVertices=[],t._hullCache=[],t._matrixCahce=[],t}return ot(P,n),P.toString=function(){return"[class dragonBones.Surface]"},P.prototype._onClear=function(){n.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},P.prototype._getAffineTransform=function(t,e,a,i,r,n,s,o,l,h,u,_,f){var m=s-r,c=o-n,p=l-r,d=h-n;u.rotation=Math.atan2(c,m),u.skew=Math.atan2(d,p)-.5*Math.PI-u.rotation,f&&(u.rotation+=Math.PI),u.scaleX=Math.sqrt(m*m+c*c)/a,u.scaleY=Math.sqrt(p*p+d*d)/i,u.toMatrix(_),u.x=_.tx=r-(_.a*t+_.c*e),u.y=_.ty=n-(_.b*t+_.d*e)},P.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,a=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var i=0,r=t.length;i<r;i+=2){var n=t[i]+a[i],s=t[i+1]+a[i],o=this._parent._getGlobalTransformMatrix(n,s);e[i]=o.a*n+o.c*s+o.tx,e[i+1]=o.b*n+o.d*s+o.ty}else{var l=this._parent.globalTransformMatrix;for(i=0,r=t.length;i<r;i+=2){n=t[i]+a[i],s=t[i+1]+a[i+1];e[i]=l.a*n+l.c*s+l.tx,e[i+1]=l.b*n+l.d*s+l.ty}}else for(i=0,r=t.length;i<r;i+=2)e[i]=t[i]+a[i],e[i+1]=t[i+1]+a[i+1]},P.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,a=this._vertices.length-2,i=this._vertices[0],r=this._vertices[1],n=this._vertices[e],s=this._vertices[e+1],o=this._vertices[a],l=this._vertices[a+1],h=this._vertices[a-e],u=this._vertices[a-e+1],_=i+.5*(o-i),f=r+.5*(l-r),m=_+.5*(n+.5*(h-n)-_),c=f+.5*(s+.5*(u-s)-f),p=n+.5*(o-n),d=s+.5*(l-s),y=h+.5*(o-h),g=u+.5*(l-u);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,m,c,p,d,y,g,this.global,this.globalTransformMatrix,!1)},P.prototype._getGlobalTransformMatrix=function(t,e){var a=1e3;if(t<-a||a<t||e<-a||a<e)return this.globalTransformMatrix;var i=!1,r=200,n=this._boneData,s=n.segmentX,o=n.segmentY,l=2*n.segmentX,h=this._dX,u=this._dY,_=Math.floor((t+r)/h),f=Math.floor((e+r)/u),m=0,c=_*h-r,p=f*u-r,d=this._matrixCahce,y=P._helpMatrix;if(t<-r){if(e<-r||r<e)return this.globalTransformMatrix;if(m=7*(2*(s*(o+1)+2*s+o+f)+((i=e>this._kX*(t+r)+p)?1:0)),0<this._matrixCahce[m])y.copyFromArray(d,m+1);else{var g=f*(l+2),D=this._hullCache[4],v=this._hullCache[5],b=this._hullCache[2]-(o-f)*D,T=this._hullCache[3]-(o-f)*v,A=this._vertices;i?this._getAffineTransform(-r,p+u,800,u,A[g+l+2],A[g+l+3],b+D,T+v,A[g],A[g+1],P._helpTransform,y,!0):this._getAffineTransform(-a,p,800,u,b,T,A[g],A[g+1],b+D,T+v,P._helpTransform,y,!1),d[m]=1,d[m+1]=y.a,d[m+2]=y.b,d[m+3]=y.c,d[m+4]=y.d,d[m+5]=y.tx,d[m+6]=y.ty}}else if(r<t){if(e<-r||r<e)return this.globalTransformMatrix;if(m=7*(2*(s*(o+1)+s+f)+((i=e>this._kX*(t-a)+p)?1:0)),0<this._matrixCahce[m])y.copyFromArray(d,m+1);else{g=(f+1)*(l+2)-2,D=this._hullCache[4],v=this._hullCache[5],b=this._hullCache[0]+f*D,T=this._hullCache[1]+f*v,A=this._vertices;i?this._getAffineTransform(a,p+u,800,u,b+D,T+v,A[g+l+2],A[g+l+3],b,T,P._helpTransform,y,!0):this._getAffineTransform(r,p,800,u,A[g],A[g+1],b,T,A[g+l+2],A[g+l+3],P._helpTransform,y,!1),d[m]=1,d[m+1]=y.a,d[m+2]=y.b,d[m+3]=y.c,d[m+4]=y.d,d[m+5]=y.tx,d[m+6]=y.ty}}else if(e<-r){if(t<-r||r<t)return this.globalTransformMatrix;if(m=7*(s*(o+1)+2*_+((i=e>this._kY*(t-c-h)-a)?1:0)),0<this._matrixCahce[m])y.copyFromArray(d,m+1);else{g=2*_,D=this._hullCache[10],v=this._hullCache[11],b=this._hullCache[8]+_*D,T=this._hullCache[9]+_*v,A=this._vertices;i?this._getAffineTransform(c+h,-r,h,800,A[g+2],A[g+3],A[g],A[g+1],b+D,T+v,P._helpTransform,y,!0):this._getAffineTransform(c,-a,h,800,b,T,b+D,T+v,A[g],A[g+1],P._helpTransform,y,!1),d[m]=1,d[m+1]=y.a,d[m+2]=y.b,d[m+3]=y.c,d[m+4]=y.d,d[m+5]=y.tx,d[m+6]=y.ty}}else if(r<e){if(t<-r||r<t)return this.globalTransformMatrix;if(m=7*(2*(s*(o+1)+s+o+f)+((i=e>this._kY*(t-c-h)+r)?1:0)),0<this._matrixCahce[m])y.copyFromArray(d,m+1);else{g=o*(l+2)+2*_,D=this._hullCache[10],v=this._hullCache[11],b=this._hullCache[6]-(s-_)*D,T=this._hullCache[7]-(s-_)*v,A=this._vertices;i?this._getAffineTransform(c+h,a,h,800,b+D,T+v,b,T,A[g+2],A[g+3],P._helpTransform,y,!0):this._getAffineTransform(c,r,h,800,A[g],A[g+1],A[g+2],A[g+3],b,T,P._helpTransform,y,!1),d[m]=1,d[m+1]=y.a,d[m+2]=y.b,d[m+3]=y.c,d[m+4]=y.d,d[m+5]=y.tx,d[m+6]=y.ty}}else if(m=7*(2*(s*f+_)+((i=e>this._k*(t-c-h)+p)?1:0)),0<this._matrixCahce[m])y.copyFromArray(d,m+1);else{g=2*_+f*(l+2),A=this._vertices;i?this._getAffineTransform(c+h,p+u,h,u,A[g+l+4],A[g+l+5],A[g+l+2],A[g+l+3],A[g+2],A[g+3],P._helpTransform,y,!0):this._getAffineTransform(c,p,h,u,A[g],A[g+1],A[g+2],A[g+3],A[g+l+2],A[g+l+3],P._helpTransform,y,!1),d[m]=1,d[m+1]=y.a,d[m+2]=y.b,d[m+3]=y.c,d[m+4]=y.d,d[m+5]=y.tx,d[m+6]=y.ty}return y},P.prototype.init=function(t){if(null===this._boneData){n.prototype.init.call(this,t);var e=t.segmentX,a=t.segmentY,i=t.vertices.length;this._dX=400/e,this._dY=400/a,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=i,this._deformVertices.length=i,this._matrixCahce.length=2*(e*a+2*e+2*a)*7,this._hullCache.length=10;for(var r=0;r<i;++r)this._deformVertices[r]=0}},P.prototype.update=function(t){if(this._blendState.dirty=!1,0<=t&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(0<=e&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(0<=e)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var a=0,i=this._armature._constraints;a<i.length;a++){(s=i[a])._root===this&&s.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){var s;(s=n[r])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var o=0,l=this._matrixCahce.length;o<l;o+=7)this._matrixCahce[o]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var h=0<=t;this._localDirty&&this._updateGlobalTransformMatrix(h),h&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var u=2*this.global.x,_=2*this.global.y,f=P._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,f),this._hullCache[0]=f.x,this._hullCache[1]=f.y,this._hullCache[2]=u-f.x,this._hullCache[3]=_-f.y,this.globalTransformMatrix.transformPoint(0,this._dY,f,!0),this._hullCache[4]=f.x,this._hullCache[5]=f.y,this.globalTransformMatrix.transformPoint(200,1e3,f),this._hullCache[6]=f.x,this._hullCache[7]=f.y,this._hullCache[8]=u-f.x,this._hullCache[9]=_-f.y,this.globalTransformMatrix.transformPoint(this._dX,0,f,!0),this._hullCache[10]=f.x,this._hullCache[11]=f.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},P}(B.Bone),B.Surface=C,F=it||(it={}),R=function(s){function A(){var t=null!==s&&s.apply(this,arguments)||this;return t._localMatrix=new F.Matrix,t._colorTransform=new F.ColorTransform,t._deformVertices=[],t._displayDatas=[],t._displayList=[],t._meshBones=[],t._meshSlots=[],t._rawDisplay=null,t._meshDisplay=null,t}return ot(A,s),A.prototype._onClear=function(){s.prototype._onClear.call(this);for(var t=[],e=0,a=this._displayList;e<a.length;e++){null!==(n=a[e])&&n!==this._rawDisplay&&n!==this._meshDisplay&&t.indexOf(n)<0&&t.push(n)}for(var i=0,r=t;i<r.length;i++){var n;(n=r[i])instanceof F.Armature?n.dispose():this._disposeDisplay(n,!1)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._meshDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._deformVertices.length=0,this._displayList.length=0,this._displayDatas.length=0,this._meshBones.length=0,this._meshSlots.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._textureData=null,this._meshData=null,this._boundingBoxData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._cachedFrameIndices=null},A.prototype._getDefaultRawDisplayData=function(){var t=this._armature.armatureData.defaultSkin;if(null!==t){var e=t.getDisplays(this._slotData.name);if(null!==e)return this._displayIndex<e.length?e[this._displayIndex]:null}return null},A.prototype._updateDisplayData=function(){var t=this._displayData,e=this._textureData,a=this._meshData,i=null;if(0<=this._displayIndex?(null!==this._rawDisplayDatas&&null===(i=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null)&&(i=this._getDefaultRawDisplayData()),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])):(i=null,this._displayData=null),null!==this._displayData&&(0===this._displayData.type||2===this._displayData.type)?2===this._displayData.type?(this._textureData=this._displayData.texture,this._meshData=this._displayData):null!==i&&2===i.type?(this._textureData=this._displayData.texture,this._meshData=i):(this._textureData=this._displayData.texture,this._meshData=null):(this._textureData=null,this._meshData=null),null!==this._displayData&&3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==i&&3===i.type?this._boundingBoxData=i.boundingBox:this._boundingBoxData=null,this._displayData!==t||this._textureData!==e||this._meshData!==a){if(null!==this._meshData)this._pivotX=0,this._pivotY=0;else if(null!==this._textureData){var r=this._displayData,n=this._textureData.parent.scale*this._armature._armatureData.scale,s=this._textureData.frame;this._pivotX=r.pivot.x,this._pivotY=r.pivot.y;var o=null!==s?s:this._textureData.region,l=o.width,h=o.height;this._textureData.rotated&&null===s&&(l=o.height,h=o.width),this._pivotX*=l*n,this._pivotY*=h*n,null!==s&&(this._pivotX+=s.x*n,this._pivotY+=s.y*n)}else this._pivotX=0,this._pivotY=0;if(null!==this._displayData&&null!==i&&this._displayData!==i&&null===this._meshData&&(i.transform.toMatrix(A._helpMatrix),A._helpMatrix.invert(),A._helpMatrix.transformPoint(0,0,A._helpPoint),this._pivotX-=A._helpPoint.x,this._pivotY-=A._helpPoint.y,this._displayData.transform.toMatrix(A._helpMatrix),A._helpMatrix.invert(),A._helpMatrix.transformPoint(0,0,A._helpPoint),this._pivotX+=A._helpPoint.x,this._pivotY+=A._helpPoint.y),null!==i?this.origin=i.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,this._meshData!==a)if(null!==this._meshData){if(null!==this._meshData.weight){this._deformVertices.length=2*this._meshData.weight.count,this._meshBones.length=this._meshData.weight.bones.length;for(var u=0,_=this._meshBones.length;u<_;++u)this._meshBones[u]=this._armature.getBone(this._meshData.weight.bones[u].name)}else{var f=this._meshData.parent.parent.parent.intArray[this._meshData.offset+0];this._deformVertices.length=2*f,this._meshBones.length=0}var m=this._armature._glueSlots;if(null!==this._meshData.glue){this._meshSlots.length=this._meshData.glue.meshes.length;for(u=0,_=this._meshSlots.length;u<_;++u){var c=this._meshData.glue.meshes[u];if(null!==c){for(var p=!1,d=0,y=this._armature.getSlots();d<y.length;d++){for(var g=y[d],D=0,v=g._displayDatas;D<v.length;D++){var b=v[D];if(null!==b&&2===b.type&&b.offset===c.offset){p=!0,this._meshSlots[u]=g;break}}if(p)break}p||(this._meshSlots[u]=null)}else this._meshSlots[u]=null}m.indexOf(this)<0&&m.push(this)}else{var T=m.indexOf(this);0<=T&&m.slice(T,1)}for(u=0,_=this._deformVertices.length;u<_;++u)this._deformVertices[u]=0;this._meshDirty=!0}else this._deformVertices.length=0,this._meshBones.length=0,this._meshSlots.length=0;else null!==this._meshData&&this._textureData!==e&&(this._meshDirty=!0);this._displayDirty=!0,this._transformDirty=!0}},A.prototype._updateDisplay=function(){var t=null!==this._display?this._display:this._rawDisplay,e=this._childArmature;0<=this._displayIndex&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof F.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var a=null!==this._display?this._display:this._rawDisplay;if(a!==t&&(this._onUpdateDisplay(),this._replaceDisplay(t),this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),a!==this._rawDisplay&&a!==this._meshDisplay||this._updateFrame(),this._childArmature!==e&&(null!==e&&(e._parent=null,e.clock=null,e.inheritAnimation&&e.animation.reset()),null!==this._childArmature&&((this._childArmature._parent=this)._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var i=this._armature.cacheFrameRate;0!==i&&(this._childArmature.cacheFrameRate=i)}var r=null;if(null!==this._displayData&&1===this._displayData.type)r=this._displayData.actions;else if(0<=this._displayIndex&&null!==this._rawDisplayDatas){var n=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null===n&&(n=this._getDefaultRawDisplayData()),null!==n&&1===n.type&&(r=n.actions)}if(null!==r&&0<r.length)for(var s=0,o=r;s<o.length;s++){var l=o[s];this._childArmature._bufferAction(l,!1)}else this._childArmature.animation.play()}},A.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},A.prototype._isMeshBonesUpdate=function(){for(var t=0,e=this._meshBones;t<e.length;t++){var a=e[t];if(null!==a&&a._childrenTransformDirty)return!0}return!1},A.prototype._setArmature=function(t){this._armature!==t&&(null!==this._armature&&this._armature._removeSlotFromSlotList(this),this._armature=t,this._onUpdateDisplay(),null!==this._armature?(this._armature._addSlotToSlotList(this),this._addDisplay()):this._removeDisplay())},A.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},A.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},A.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},A.prototype._setDisplayList=function(t){if(null!==t&&0<t.length){this._displayList.length!==t.length&&(this._displayList.length=t.length);for(var e=0,a=t.length;e<a;++e){var i=t[e];null!==i&&i!==this._rawDisplay&&i!==this._meshDisplay&&!(i instanceof F.Armature)&&this._displayList.indexOf(i)<0&&this._initDisplay(i,!0),this._displayList[e]=i}}else 0<this._displayList.length&&(this._displayList.length=0);return 0<=this._displayIndex&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},A.prototype.init=function(t,e,a,i){null===this._slotData&&(this._slotData=t,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=a,this._meshDisplay=i,this.rawDisplayDatas=e,this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1))},A.prototype.update=function(t){if(this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),0<=t&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];0<=e&&this._cachedFrameIndex===e?this._transformDirty=!1:0<=e?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):0<=this._cachedFrameIndex?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._meshData&&this._display===this._meshDisplay){var a=null!==this._meshData.weight,i=0!==this._parent._boneData.type,r=null!==this._meshData.glue;if((this._meshDirty||a&&this._isMeshBonesUpdate()||i&&this._parent._childrenTransformDirty||r&&this._parent._childrenTransformDirty)&&(this._meshDirty=!1,this._updateMesh()),a||i||r)return}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var n=0<=t;this._updateGlobalTransformMatrix(n),n&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform()}}},A.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},A.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var a=0,i=this._displayDatas.length;a<i;++a)this._displayDatas[a]||(this._displayDatas[a]=null)}this._displayDatas[e]=t},A.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),A._helpMatrix.copyFrom(this.globalTransformMatrix),A._helpMatrix.invert(),A._helpMatrix.transformPoint(t,e,A._helpPoint),this._boundingBoxData.containsPoint(A._helpPoint.x,A._helpPoint.y))},A.prototype.intersectsSegment=function(t,e,a,i,r,n,s){if(void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),A._helpMatrix.copyFrom(this.globalTransformMatrix),A._helpMatrix.invert(),A._helpMatrix.transformPoint(t,e,A._helpPoint),t=A._helpPoint.x,e=A._helpPoint.y,A._helpMatrix.transformPoint(a,i,A._helpPoint),a=A._helpPoint.x,i=A._helpPoint.y;var o=this._boundingBoxData.intersectsSegment(t,e,a,i,r,n,s);return 0<o&&(1===o||2===o?null!==r?(this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==n&&(n.x=r.x,n.y=r.y)):null!==n&&this.globalTransformMatrix.transformPoint(n.x,n.y,n):(null!==r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==n&&this.globalTransformMatrix.transformPoint(n.x,n.y,n)),null!==s&&(this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),A._helpPoint,!0),s.x=Math.atan2(A._helpPoint.y,A._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),A._helpPoint,!0),s.y=Math.atan2(A._helpPoint.y,A._helpPoint.x))),o},A.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(A.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(t){var e=this._displayList.concat(),a=new Array;this._setDisplayList(t)&&this.update(-1);for(var i=0,r=e;i<r.length;i++){null!==(o=r[i])&&o!==this._rawDisplay&&o!==this._meshDisplay&&this._displayList.indexOf(o)<0&&a.indexOf(o)<0&&a.push(o)}for(var n=0,s=a;n<s.length;n++){var o;(o=s[n])instanceof F.Armature?o.dispose():this._disposeDisplay(o,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,a=this._displayDatas.length;e<a;++e){var i=this._rawDisplayDatas[e];null===i&&(i=this._getDefaultRawDisplayData()),this._displayDatas[e]=i}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var a=this.displayList;e<=this._displayIndex&&(a.length=this._displayIndex+1);var i=a[this._displayIndex]=t;i._rawScale={x:t.scale.x,y:t.scale.y},i._replacePivot=t.pivot,this.displayList=a}}},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),A.prototype.getDisplay=function(){return this.display},A.prototype.setDisplay=function(t){this.display=t},A}(F.TransformObject),F.Slot=R,N=it||(it={}),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(e.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),e._helpMatrix=new N.Matrix,e._helpTransform=new N.Transform,e._helpPoint=new N.Point,e}(N.BaseObject),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.IKConstraint]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},e.prototype._computeA=function(){var t=this._target.global,e=this._root.global,a=this._root.globalTransformMatrix,i=Math.atan2(t.y-e.y,t.x-e.x);e.scaleX<0&&(i+=Math.PI),e.rotation+=(i-e.rotation)*this._weight,e.toMatrix(a)},e.prototype._computeB=function(){var t=this._bone._boneData.length,e=this._root,a=this._target.global,i=e.global,r=this._bone.global,n=this._bone.globalTransformMatrix,s=n.a*t,o=n.b*t,l=s*s+o*o,h=Math.sqrt(l),u=r.x-i.x,_=r.y-i.y,f=u*u+_*_,m=Math.sqrt(f),c=r.rotation,p=i.rotation,d=Math.atan2(_,u),y=(u=a.x-i.x)*u+(_=a.y-i.y)*_,g=Math.sqrt(y),D=0;if(h+m<=g||g+h<=m||g+m<=h)D=Math.atan2(a.y-i.y,a.x-i.x),h+m<=g||m<h&&(D+=Math.PI);else{var v=(f-l+y)/(2*y),b=Math.sqrt(f-v*v*y)/g,T=i.x+u*v,A=i.y+_*v,P=-_*b,S=u*b,x=!1;if(null!==e._parent){var O=e._parent.globalTransformMatrix;x=O.a*O.d-O.b*O.c<0}x!==this._bendPositive?(r.x=T-P,r.y=A-S):(r.x=T+P,r.y=A+S),D=Math.atan2(r.y-i.y,r.x-i.x)}var M=N.Transform.normalizeRadian(D-d);i.rotation=p+M*this._weight,i.toMatrix(e.globalTransformMatrix);var w=d+M*this._weight;r.x=i.x+Math.cos(w)*m,r.y=i.y+Math.sin(w)*m;var I=Math.atan2(a.y-r.y,a.x-r.x);r.scaleX<0&&(I+=Math.PI),r.rotation=i.rotation+c-p+N.Transform.normalizeRadian(I-M-c)*this._weight,r.toMatrix(n)},e.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var a=this._constraintData;this._scaleEnabled=a.scaleEnabled,this._scaleEnabled=this._scaleEnabled,this._bendPositive=a.bendPositive,this._weight=a.weight,this._root._hasConstraint=!0}},e.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},e.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},e}(N.Constraint=k),N.IKConstraint=j,L=it||(it={}),U=function(){function t(t){void 0===t&&(t=-1),this.time=0,this.timeScale=1,this._animatebles=[],this._clock=null,this.time=t<0?.001*(new Date).getTime():t}return t.prototype.advanceTime=function(t){if(t!=t&&(t=0),t<0&&(t=.001*(new Date).getTime()-this.time),1!==this.timeScale&&(t*=this.timeScale),t<0?this.time-=t:this.time+=t,0!==t){for(var e=0,a=0,i=this._animatebles.length;e<i;++e){var r=this._animatebles[e];null!==r?(0<a&&(this._animatebles[e-a]=r,this._animatebles[e]=null),r.advanceTime(t)):a++}if(0<a){for(i=this._animatebles.length;e<i;++e){var n=this._animatebles[e];null!==n?this._animatebles[e-a]=n:a++}this._animatebles.length-=a}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);0<=e&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var a=e[t];null!==a&&(a.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t.clock=new t,t}(),L.WorldClock=U,Y=it||(it={}),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.Animation]"},t.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}for(var a in this._animations)delete this._animations[a];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},t.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,a=this._animationStates;e<a.length;e++){null===(h=a[e])._parent&&(h.layer===t.layer&&h.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 2:for(var i=0,r=this._animationStates;i<r.length;i++){null===(h=r[i])._parent&&(h.group===t.group&&h.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 3:for(var n=0,s=this._animationStates;n<s.length;n++){null===(h=s[n])._parent&&(h.layer===t.layer&&h.group===t.group&&h.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 4:for(var o=0,l=this._animationStates;o<l.length;o++){var h;null===(h=l[o])._parent&&h.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},t.prototype.init=function(t){null===this._armature&&(this._armature=t,this._animationConfig=Y.BaseObject.borrowObject(Y.AnimationConfig))},t.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if(0<(f=this._animationStates[0])._fadeState&&0<f._subFadeState)this._armature._dragonBones.bufferObject(f),this._animationStates.length=0,this._lastAnimationState=null;else{var a=f._animationData,i=a.cacheFrameRate;if(this._animationDirty&&0<i){this._animationDirty=!1;for(var r=0,n=this._armature.getBones();r<n.length;r++){var s=n[r];s._cachedFrameIndices=a.getBoneCachedFrameIndices(s.name)}for(var o=0,l=this._armature.getSlots();o<l.length;o++){var h=l[o];h._cachedFrameIndices=a.getSlotCachedFrameIndices(h.name)}}f.advanceTime(t,i)}else if(1<e){for(var u=0,_=0;u<e;++u){var f;0<(f=this._animationStates[u])._fadeState&&0<f._subFadeState?(_++,this._armature._dragonBones.bufferObject(f),this._animationDirty=!0,this._lastAnimationState===f&&(this._lastAnimationState=null)):(0<_&&(this._animationStates[u-_]=f),f.advanceTime(t,0)),u===e-1&&0<_&&(this._animationStates.length-=_,null===this._lastAnimationState&&0<this._animationStates.length&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},t.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},t.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(i=this.getState(t))&&i.stop();else for(var e=0,a=this._animationStates;e<a.length;e++){var i;(i=a[e]).stop()}},t.prototype.playConfig=function(t){var e=t.animation;if(!(e in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+e),null;var a=this._animations[e];if(5===t.fadeOutMode)for(var i=0,r=this._animationStates;i<r.length;i++){var n=r[i];if(n._animationData===a)return n}0===this._animationStates.length?t.fadeInTime=0:t.fadeInTime<0&&(t.fadeInTime=a.fadeInTime),t.fadeOutTime<0&&(t.fadeOutTime=t.fadeInTime),t.timeScale<=-100&&(t.timeScale=1/a.scale),1<a.frameCount?(t.position<0?(t.position%=a.duration,t.position=a.duration-t.position):t.position===a.duration?t.position-=1e-6:t.position>a.duration&&(t.position%=a.duration),0<t.duration&&t.position+t.duration>a.duration&&(t.duration=a.duration-t.position),t.playTimes<0&&(t.playTimes=a.playTimes)):(t.playTimes=1,(t.position=0)<t.duration&&(t.duration=0)),0===t.duration&&(t.duration=-1),this._fadeOut(t);var s=Y.BaseObject.borrowObject(Y.AnimationState);if(s.init(this._armature,a,t),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,0<this._animationStates.length){for(var o=!1,l=0,h=this._animationStates.length;l<h;++l){if(s.layer>this._animationStates[l].layer){o=!0,this._animationStates.splice(l,0,s);break}if(l!==h-1&&s.layer>this._animationStates[l+1].layer){o=!0,this._animationStates.splice(l+1,0,s);break}}o||this._animationStates.push(s)}else this._animationStates.push(s);for(var u=0,_=this._armature.getSlots();u<_.length;u++){var f=_[u].childArmature;null!==f&&f.inheritAnimation&&f.animation.hasAnimation(e)&&null===f.animation.getState(e)&&f.animation.fadeIn(e)}var m=!1;for(var c in a.animationTimelines){this._lockUpdate||(m=!0,this._lockUpdate=!0);var p=this.fadeIn(c,t.fadeInTime,1,s.layer,null,0);null!==p&&(p.resetToPose=!1,p._parent=s,p.stop())}return m&&(this._lockUpdate=!1),this._lockUpdate||(t.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=s),s},t.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&0<t.length)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var a=this._armature.armatureData.defaultAnimation;null!==a&&(this._animationConfig.animation=a.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},t.prototype.fadeIn=function(t,e,a,i,r,n){return void 0===e&&(e=-1),void 0===a&&(a=-1),void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=n,this._animationConfig.playTimes=a,this._animationConfig.layer=i,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},t.prototype.gotoAndPlayByTime=function(t,e,a){return void 0===e&&(e=0),void 0===a&&(a=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=a,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},t.prototype.gotoAndPlayByFrame=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=a,this._animationConfig.fadeInTime=0;var i=(this._animationConfig.animation=t)in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*e/i.frameCount),this.playConfig(this._animationConfig)},t.prototype.gotoAndPlayByProgress=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=a,this._animationConfig.fadeInTime=0;var i=(this._animationConfig.animation=t)in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*(0<e?e:0)),this.playConfig(this._animationConfig)},t.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var a=this.gotoAndPlayByTime(t,e,1);return null!==a&&a.stop(),a},t.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var a=this.gotoAndPlayByFrame(t,e,1);return null!==a&&a.stop(),a},t.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var a=this.gotoAndPlayByProgress(t,e,1);return null!==a&&a.stop(),a},t.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var a=this._animationStates[e];if(a.name===t)return a}return null},t.prototype.hasAnimation=function(t){return t in this._animations},t.prototype.getStates=function(){return this._animationStates},Object.defineProperty(t.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(e[t].isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(!e[t].isCompleted)return!1}return 0<this._animationStates.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),t.prototype.gotoAndPlay=function(t,e,a,i,r,n,s,o,l){void 0===e&&(e=-1),void 0===a&&(a=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===s&&(s=3),void 0===o&&(o=!0),void 0===l&&(l=!0),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==n?n:"";var h=this._animations[t];return h&&0<a&&(this._animationConfig.timeScale=h.duration/a),this.playConfig(this._animationConfig)},t.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),this.gotoAndStopByTime(t,e)},Object.defineProperty(t.prototype,"animationList",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationDataList",{get:function(){for(var t=[],e=0,a=this._animationNames.length;e<a;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),t}(Y.BaseObject),Y.Animation=X,function(N){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendState=new a,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.AnimationState]"},t.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){e[t].returnToPool()}for(var a=0,i=this._surfaceTimelines;a<i.length;a++){i[a].returnToPool()}for(var r=0,n=this._slotTimelines;r<n.length;r++){n[r].returnToPool()}for(var s=0,o=this._constraintTimelines;s<o.length;s++){o[s].returnToPool()}for(var l=0,h=this._animationTimelines;l<h.length;l++){h[l].returnToPool()}for(var u in this._bonePoses)this._bonePoses[u].returnToPool(),delete this._bonePoses[u];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},t.prototype._updateTimelines=function(){for(var t=0,e=this._armature._constraints;t<e.length;t++){var a=e[t];if(null!==(o=this._animationData.getConstraintTimelines(a.name)))for(var i=0,r=o;i<r.length;i++){switch((_=r[i]).type){case 30:(f=N.BaseObject.borrowObject(N.IKConstraintTimelineState)).constraint=a,f.init(this._armature,this,_),this._constraintTimelines.push(f)}}else if(this.resetToPose){(f=N.BaseObject.borrowObject(N.IKConstraintTimelineState)).constraint=a,f.init(this._armature,this,null),this._constraintTimelines.push(f),this._poseTimelines.push(f)}}for(var n=0,s=this._armature.animation.getStates();n<s.length;n++){var o,l=s[n];if(l._parent===this)if(null!==(o=this._animationData.getAnimationTimelines(l.name)))for(var h=0,u=o;h<u.length;h++){var _;switch((_=u[h]).type){case 40:var f;(f=N.BaseObject.borrowObject(N.AnimationTimelineState)).animationState=l,f.init(this._armature,this,_),this._animationTimelines.push(f)}}}},t.prototype._updateBoneAndSlotTimelines=function(){for(var t={},e=0,a=this._boneTimelines;e<a.length;e++){(s=(d=a[e]).bone.name)in t||(t[s]=[]),t[s].push(d)}for(var i=0,r=this._armature.getBones();i<r.length;i++){var n=r[i],s=n.name;if(this.containsBoneMask(s))if(s in t)delete t[s];else if(0===n._boneData.type){var o=this._animationData.getBoneTimelines(s),l=s in this._bonePoses?this._bonePoses[s]:this._bonePoses[s]=N.BaseObject.borrowObject(k);if(null!==o)for(var h=0,u=o;h<u.length;h++){switch((w=u[h]).type){case 10:(d=N.BaseObject.borrowObject(N.BoneAllTimelineState)).bone=n,d.bonePose=l,d.init(this._armature,this,w),this._boneTimelines.push(d);break;case 11:(d=N.BaseObject.borrowObject(N.BoneTranslateTimelineState)).bone=n,d.bonePose=l,d.init(this._armature,this,w),this._boneTimelines.push(d);break;case 12:(d=N.BaseObject.borrowObject(N.BoneRotateTimelineState)).bone=n,d.bonePose=l,d.init(this._armature,this,w),this._boneTimelines.push(d);break;case 13:(d=N.BaseObject.borrowObject(N.BoneScaleTimelineState)).bone=n,d.bonePose=l,d.init(this._armature,this,w),this._boneTimelines.push(d)}}else if(this.resetToPose){(d=N.BaseObject.borrowObject(N.BoneAllTimelineState)).bone=n,d.bonePose=l,d.init(this._armature,this,null),this._boneTimelines.push(d),this._poseTimelines.push(d)}}else if(1===n._boneData.type){if(null!==(o=this._animationData.getSurfaceTimelines(s)))for(var _=0,f=o;_<f.length;_++){switch((w=f[_]).type){case 50:(d=N.BaseObject.borrowObject(N.SurfaceTimelineState)).surface=n,d.init(this._armature,this,w),this._surfaceTimelines.push(d)}}else if(this.resetToPose){(d=N.BaseObject.borrowObject(N.SurfaceTimelineState)).surface=n,d.init(this._armature,this,null),this._surfaceTimelines.push(d),this._poseTimelines.push(d)}}}for(var m in t)for(var c=0,p=t[m];c<p.length;c++){var d=p[c];this._boneTimelines.splice(this._boneTimelines.indexOf(d),1),d.returnToPool()}for(var y={},g=[],D=0,v=this._slotTimelines;D<v.length;D++){(s=(d=v[D]).slot.name)in y||(y[s]=[]),y[s].push(d)}for(var b=0,T=this._armature.getSlots();b<T.length;b++){var A=T[b],P=A.parent.name;if(this.containsBoneMask(P)){s=A.name,o=this._animationData.getSlotTimelines(s);if(s in y)delete y[s];else{var S=!1,x=!1;if(g.length=0,null!==o)for(var O=0,M=o;O<M.length;O++){var w;switch((w=M[O]).type){case 20:(d=N.BaseObject.borrowObject(N.SlotDislayTimelineState)).slot=A,d.init(this._armature,this,w),this._slotTimelines.push(d),S=!0;break;case 21:(d=N.BaseObject.borrowObject(N.SlotColorTimelineState)).slot=A,d.init(this._armature,this,w),this._slotTimelines.push(d),x=!0;break;case 22:(d=N.BaseObject.borrowObject(N.SlotFFDTimelineState)).slot=A,d.init(this._armature,this,w),this._slotTimelines.push(d),g.push(d.meshOffset)}}if(this.resetToPose){if(!S)(d=N.BaseObject.borrowObject(N.SlotDislayTimelineState)).slot=A,d.init(this._armature,this,null),this._slotTimelines.push(d),this._poseTimelines.push(d);if(!x)(d=N.BaseObject.borrowObject(N.SlotColorTimelineState)).slot=A,d.init(this._armature,this,null),this._slotTimelines.push(d),this._poseTimelines.push(d);if(null!==A.rawDisplayDatas)for(var I=0,E=A.rawDisplayDatas;I<E.length;I++){var B=E[I];if(null!==B&&2===B.type){var C=B.offset;if(g.indexOf(C)<0)(d=N.BaseObject.borrowObject(N.SlotFFDTimelineState)).meshOffset=C,d.slot=A,d.init(this._armature,this,null),this._slotTimelines.push(d),this._poseTimelines.push(d)}}}}}}for(var m in y)for(var F=0,R=y[m];F<R.length;F++){d=R[F];this._slotTimelines.splice(this._slotTimelines.indexOf(d),1),d.returnToPool()}},t.prototype._advanceFadeTime=function(t){var e=0<this._fadeState;if(this._subFadeState<0){this._subFadeState=0;var a=e?N.EventObject.FADE_OUT:N.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(a))(i=N.BaseObject.borrowObject(N.EventObject)).type=a,i.armature=this._armature,(i.animationState=this)._armature._dragonBones.bufferEvent(i)}if(t<0&&(t=-t),this._fadeTime+=t,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=e?0:1):0<this._fadeTime?this._fadeProgress=e?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=e?1:0,0<this._subFadeState){e||(this._playheadState|=1,this._fadeState=0);var i;a=e?N.EventObject.FADE_OUT_COMPLETE:N.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(a))(i=N.BaseObject.borrowObject(N.EventObject)).type=a,i.armature=this._armature,(i.animationState=this)._armature._dragonBones.bufferEvent(i)}},t.prototype.init=function(t,e,a){if(null===this._armature){if(this._armature=t,this._animationData=e,this.resetToPose=a.resetToPose,this.additiveBlending=a.additiveBlending,this.displayControl=a.displayControl,this.actionEnabled=a.actionEnabled,this.layer=a.layer,this.playTimes=a.playTimes,this.timeScale=a.timeScale,this.fadeTotalTime=a.fadeInTime,this.autoFadeOutTime=a.autoFadeOutTime,this.weight=a.weight,this.name=0<a.name.length?a.name:a.animation,this.group=a.group,a.pauseFadeIn?this._playheadState=2:this._playheadState=3,a.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==a.position?0<=this.timeScale?this._time=a.position:this._time=a.position-this._duration:this._time=0):(this._position=a.position,this._duration=a.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),0<a.boneMask.length){this._boneMask.length=a.boneMask.length;for(var i=0,r=this._boneMask.length;i<r;++i)this._boneMask[i]=a.boneMask[i]}this._actionTimeline=N.BaseObject.borrowObject(N.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=N.BaseObject.borrowObject(N.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},t.prototype.advanceTime=function(t,e){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var a=0===this._fadeState&&0<e,i=!0,r=!0,n=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(n),a){var s=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*s)/s}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(n),a){var o=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===o?r=i=!1:(this._armature._cacheFrameIndex=o,this._animationData.cachedFrames[o]?r=!1:this._animationData.cachedFrames[o]=!0)}if(i){if(r)for(var l=0,h=this._boneTimelines.length;l<h;++l){if((c=this._boneTimelines[l]).playState<=0&&c.update(n),l===h-1||c.bone!==this._boneTimelines[l+1].bone)0!==(u=c.bone._blendState.update(this._weightResult,this.layer))&&c.blend(u)}for(l=0,h=this._surfaceTimelines.length;l<h;++l){var u=(c=this._surfaceTimelines[l]).surface._blendState.update(this._weightResult,this.layer);c.playState<=0&&c.update(n),0!==u&&c.blend(u)}if(this.displayControl)for(l=0,h=this._slotTimelines.length;l<h;++l){var _=(c=this._slotTimelines[l]).slot.displayController;null!==_&&_!==this.name&&_!==this.group||c.playState<=0&&c.update(n)}for(l=0,h=this._constraintTimelines.length;l<h;++l){(c=this._constraintTimelines[l]).playState<=0&&c.update(n)}for(l=0,h=this._animationTimelines.length;l<h;++l){u=(c=this._animationTimelines[l]).animationState._blendState.update(this._weightResult,this.layer);c.playState<=0&&c.update(n),0!==u&&c.blend(u)}}if(0===this._fadeState){if(0<this._subFadeState&&(this._subFadeState=0)<this._poseTimelines.length){for(var f=0,m=this._poseTimelines;f<m.length;f++){var c;(c=m[f])instanceof N.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(c),1):c instanceof N.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(c),1):c instanceof N.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(c),1):c instanceof N.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(c),1),c.returnToPool()}this._poseTimelines.length=0}0<this._actionTimeline.playState&&0<=this.autoFadeOutTime&&this.fadeOut(this.autoFadeOutTime)}}},t.prototype.play=function(){this._playheadState=3},t.prototype.stop=function(){this._playheadState&=1},t.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),0<this._fadeState){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var a=0,i=this._boneTimelines;a<i.length;a++){(f=i[a]).fadeOut()}for(var r=0,n=this._surfaceTimelines;r<n.length;r++){(f=n[r]).fadeOut()}for(var s=0,o=this._slotTimelines;s<o.length;s++){(f=o[s]).fadeOut()}for(var l=0,h=this._constraintTimelines;l<h.length;l++){(f=h[l]).fadeOut()}for(var u=0,_=this._animationTimelines;u<_.length;u++){var f;(f=_[u]).animationState.fadeOut(t,e),f.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=1e-6<this._fadeProgress?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},t.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||0<=this._boneMask.indexOf(t)},t.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var a=this._armature.getBone(t);if(null!==a){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var i=0,r=this._armature.getBones();i<r.length;i++){var n=r[i];this._boneMask.indexOf(n.name)<0&&a.contains(n)&&this._boneMask.push(n.name)}this._timelineDirty=1}},t.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var a=this._boneMask.indexOf(t);if(0<=a&&this._boneMask.splice(a,1),e){var i=this._armature.getBone(t);if(null!==i){var r=this._armature.getBones();if(0<this._boneMask.length)for(var n=0,s=r;n<s.length;n++){var o=s[n],l=this._boneMask.indexOf(o.name);0<=l&&i.contains(o)&&this._boneMask.splice(l,1)}else for(var h=0,u=r;h<u.length;h++){(o=u[h])!==i&&(i.contains(o)||this._boneMask.push(o.name))}}}this._timelineDirty=1},t.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(t.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFadeOut",{get:function(){return 0<this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCompleted",{get:function(){return 0<this._actionTimeline.playState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(0<this._actionTimeline.playState?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),0<this.playTimes&&e===this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var a=0,i=this._boneTimelines;a<i.length;a++){i[a].playState=-1}for(var r=0,n=this._slotTimelines;r<n.length;r++){n[r].playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),t}(N.BaseObject);N.AnimationState=t;var k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.current=new N.Transform,t.delta=new N.Transform,t.result=new N.Transform,t}return ot(t,e),t.toString=function(){return"[class dragonBones.BonePose]"},t.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},t}(N.BaseObject);N.BonePose=k;var a=function(){function t(){}return t.prototype.update=function(t,e){if(this.dirty){if(!(0<this.leftWeight))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,1}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,-1},t.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},t}();N.BlendState=a}(it||(it={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,a=this.currentPlayTimes,i=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=0<=this._actionTimeline.playState?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,n=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),0<r&&(n<=t||t<=-n)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==a||this.currentTime!==i)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==a)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,a){this._armature=t,this._animationState=e,this._timelineData=a,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(1<this._frameCount){var e=Math.floor(this.currentTime*this._frameRate),a=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==a&&(this._frameIndex=a,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},Object.defineProperty(e.prototype,"currentPlayTimes",{get:function(){return this._currentPlayTimes},set:function(t){this._currentPlayTimes=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._currentTime},set:function(t){this._currentTime=t},enumerable:!0,configurable:!0}),e}(t.BaseObject),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e._getEasingValue=function(t,e,a){var i=e;switch(t){case 3:i=Math.pow(e,2);break;case 4:i=1-Math.pow(1-e,2);break;case 5:i=.5*(1-Math.cos(e*Math.PI))}return(i-e)*a+e},e._getEasingCurveValue=function(t,e,a,i){if(t<=0)return 0;if(1<=t)return 1;var r=a+1,n=Math.floor(t*r),s=0===n?0:e[i+n-1];return 1e-4*(s+((n===r-1?1e4:e[i+n])-s)*(t*r-n))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(1<this._frameCount&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=0<e?1/e:0}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(t.TimelineState=e),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,a=this.bone.animationPose,i=this.bonePose.result;0<t?(a.x+=i.x*e,a.y+=i.y*e,a.rotation+=i.rotation*e,a.skew+=i.skew*e,a.scaleX+=(i.scaleX-1)*e,a.scaleY+=(i.scaleY-1)*e):1!==e?(a.x=i.x*e,a.y=i.y*e,a.rotation=i.rotation*e,a.skew=i.skew*e,a.scaleX=(i.scaleX-1)*e+1,a.scaleY=(i.scaleY-1)*e+1):(a.x=i.x,a.y=i.y,a.rotation=i.rotation,a.skew=i.skew,a.scaleX=i.scaleX,a.scaleY=i.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},e}(t.TweenTimelineState=a);t.BoneTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(a);t.SlotTimelineState=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.constraint=null},e}(a);t.ConstraintTimelineState=n}(it||(it={})),function(d){var t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.ActionTimelineState]"},e.prototype._onCrossFrame=function(t){var e=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var a=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+t],i=this._frameArray[a+1],r=this._animationData.parent.actions,n=0;n<i;++n){var s=r[this._frameArray[a+2+n]];if(0===s.type){if(null!==s.slot){if(null!==(h=this._armature.getSlot(s.slot.name)))null!==(u=h.childArmature)&&u._bufferAction(s,!0)}else if(null!==s.bone)for(var o=0,l=this._armature.getSlots();o<l.length;o++){var h,u;null!==(u=(h=l[o]).childArmature)&&h.parent._boneData===s.bone&&u._bufferAction(s,!0)}else this._armature._bufferAction(s,!0)}else{var _=10===s.type?d.EventObject.FRAME_EVENT:d.EventObject.SOUND_EVENT;if(11===s.type||e.hasDBEventListener(_)){var f=d.BaseObject.borrowObject(d.EventObject);f.time=this._frameArray[a]/this._frameRate,f.type=_,f.name=s.name,f.data=s.data,f.armature=this._armature,f.animationState=this._animationState,null!==s.bone&&(f.bone=this._armature.getBone(s.bone.name)),null!==s.slot&&(f.slot=this._armature.getSlot(s.slot.name)),this._armature._dragonBones.bufferEvent(f)}}}},e.prototype._onArriveAtFrame=function(){},e.prototype._onUpdateFrame=function(){},e.prototype.update=function(t){var e=this.playState,a=this.currentPlayTimes,i=this.currentTime;if(this._setCurrentTime(t)){var r=this._armature.eventDispatcher;if(e<0){if(this.playState===e)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),a=this.currentPlayTimes,r.hasDBEventListener(d.EventObject.START)){var n=d.BaseObject.borrowObject(d.EventObject);n.type=d.EventObject.START,n.armature=this._armature,n.animationState=this._animationState,this._armature._dragonBones.bufferEvent(n)}}var s=this._animationState.timeScale<0,o=null,l=null;if(this.currentPlayTimes!==a&&(r.hasDBEventListener(d.EventObject.LOOP_COMPLETE)&&((o=d.BaseObject.borrowObject(d.EventObject)).type=d.EventObject.LOOP_COMPLETE,o.armature=this._armature,o.animationState=this._animationState),0<this.playState&&r.hasDBEventListener(d.EventObject.COMPLETE)&&((l=d.BaseObject.borrowObject(d.EventObject)).type=d.EventObject.COMPLETE,l.armature=this._armature,l.animationState=this._animationState)),1<this._frameCount){var h=this._timelineData,u=Math.floor(this.currentTime*this._frameRate),_=this._frameIndices[h.frameIndicesOffset+u];if(this._frameIndex!==_){var f=this._frameIndex;if(this._frameIndex=_,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[h.offset+5+this._frameIndex],s){if(f<0){var m=Math.floor(i*this._frameRate);f=this._frameIndices[h.frameIndicesOffset+m],this.currentPlayTimes===a&&f===_&&(f=-1)}for(;0<=f;){var c=this._animationData.frameOffset+this._timelineArray[h.offset+5+f],p=this._frameArray[c]/this._frameRate;if(this._position<=p&&p<=this._position+this._duration&&this._onCrossFrame(f),null!==o&&0===f&&(this._armature._dragonBones.bufferEvent(o),o=null),0<f?f--:f=this._frameCount-1,f===_)break}}else{if(f<0){m=Math.floor(i*this._frameRate);f=this._frameIndices[h.frameIndicesOffset+m];c=this._animationData.frameOffset+this._timelineArray[h.offset+5+f],p=this._frameArray[c]/this._frameRate;this.currentPlayTimes===a&&(i<=p?0<f?f--:f=this._frameCount-1:f===_&&(f=-1))}for(;0<=f;){f<this._frameCount-1?f++:f=0;c=this._animationData.frameOffset+this._timelineArray[h.offset+5+f],p=this._frameArray[c]/this._frameRate;if(this._position<=p&&p<=this._position+this._duration&&this._onCrossFrame(f),null!==o&&0===f&&(this._armature._dragonBones.bufferEvent(o),o=null),f===_)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];p=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===a?i<=p&&this._onCrossFrame(this._frameIndex):this._position<=p&&(s||null===o||(this._armature._dragonBones.bufferEvent(o),o=null),this._onCrossFrame(this._frameIndex))}null!==o&&this._armature._dragonBones.bufferEvent(o),null!==l&&this._armature._dragonBones.bufferEvent(l)}},e.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},e}(d.TimelineState);d.ActionTimelineState=t;var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){0<=this.playState&&(0<this._frameArray[this._frameOffset+1]?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(d.TimelineState);d.ZOrderTimelineState=e;var a=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return ot(t,n),t.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,e=this._armature._armatureData.scale,a=this._frameFloatArray,i=this.bonePose.current,r=this.bonePose.delta;i.x=a[t++]*e,i.y=a[t++]*e,i.rotation=a[t++],i.skew=a[t++],i.scaleX=a[t++],i.scaleY=a[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),r.x=a[t++]*e-i.x,r.y=a[t++]*e-i.y,r.rotation=a[t++]-i.rotation,r.skew=a[t++]-i.skew,r.scaleX=a[t++]-i.scaleX,r.scaleY=a[t++]-i.scaleY):(r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=0,r.scaleY=0)}else{i=this.bonePose.current,r=this.bonePose.delta;i.x=0,i.y=0,i.rotation=0,i.skew=0,i.scaleX=1,i.scaleY=1,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=0,r.scaleY=0}},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,a=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),a.x=t.x+e.x*this._tweenProgress,a.y=t.y+e.y*this._tweenProgress,a.rotation=t.rotation+e.rotation*this._tweenProgress,a.skew=t.skew+e.skew*this._tweenProgress,a.scaleX=t.scaleX+e.scaleX*this._tweenProgress,a.scaleY=t.scaleY+e.scaleY*this._tweenProgress},t.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=d.Transform.normalizeRadian(t.rotation),t.skew=d.Transform.normalizeRadian(t.skew)},t}(d.BoneTimelineState);d.BoneAllTimelineState=a;var i=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return ot(t,n),t.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._armature._armatureData.scale,a=this._frameFloatArray,i=this.bonePose.current,r=this.bonePose.delta;i.x=a[t++]*e,i.y=a[t++]*e,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),r.x=a[t++]*e-i.x,r.y=a[t++]*e-i.y):(r.x=0,r.y=0)}else{i=this.bonePose.current,r=this.bonePose.delta;i.x=0,i.y=0,r.x=0,r.y=0}},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,a=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),a.x=t.x+e.x*this._tweenProgress,a.y=t.y+e.y*this._tweenProgress},t}(d.BoneTimelineState);d.BoneTranslateTimelineState=i;var r=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return ot(t,r),t.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},t.prototype._onArriveAtFrame=function(){if(r.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._frameFloatArray,a=this.bonePose.current,i=this.bonePose.delta;a.rotation=e[t++],a.skew=e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),i.rotation=e[t++]-a.rotation,i.skew=e[t++]-a.skew):(i.rotation=0,i.skew=0)}else{a=this.bonePose.current,i=this.bonePose.delta;a.rotation=0,a.skew=0,i.rotation=0,i.skew=0}},t.prototype._onUpdateFrame=function(){r.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,a=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),a.rotation=t.rotation+e.rotation*this._tweenProgress,a.skew=t.skew+e.skew*this._tweenProgress},t.prototype.fadeOut=function(){var t=this.bonePose.result;t.rotation=d.Transform.normalizeRadian(t.rotation),t.skew=d.Transform.normalizeRadian(t.skew)},t}(d.BoneTimelineState);d.BoneRotateTimelineState=r;var n=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return ot(t,r),t.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},t.prototype._onArriveAtFrame=function(){if(r.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,e=this._frameFloatArray,a=this.bonePose.current,i=this.bonePose.delta;a.scaleX=e[t++],a.scaleY=e[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),i.scaleX=e[t++]-a.scaleX,i.scaleY=e[t++]-a.scaleY):(i.scaleX=0,i.scaleY=0)}else{a=this.bonePose.current,i=this.bonePose.delta;a.scaleX=1,a.scaleY=1,i.scaleX=0,i.scaleY=0}},t.prototype._onUpdateFrame=function(){r.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,e=this.bonePose.delta,a=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),a.scaleX=t.scaleX+e.scaleX*this._tweenProgress,a.scaleY=t.scaleY+e.scaleY*this._tweenProgress},t}(d.BoneTimelineState);d.BoneScaleTimelineState=n;var s=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}return ot(t,n),t.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,e=this._armature._armatureData.scale,a=this._frameFloatArray;if(2===this._tweenState){var i=t+this._valueCount;this._frameIndex===this._frameCount-1&&(i=this._animationData.frameFloatOffset+this._frameValueOffset);for(var r=0;r<this._valueCount;++r)this._delta[r]=a[i+r]*e-(this._current[r]=a[t+r]*e)}else for(r=0;r<this._valueCount;++r)this._current[r]=a[t+r]*e}else for(r=0;r<this._valueCount;++r)this._current[r]=0},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},t.prototype.init=function(t,e,a){if(n.prototype.init.call(this,t,e,a),null!==this._timelineData){var i=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._deformCount=this._frameIntArray[i+1],this._valueCount=this._frameIntArray[i+2],this._valueOffset=this._frameIntArray[i+3],this._frameFloatOffset=this._frameIntArray[i+4]+this._animationData.frameFloatOffset}else this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var r=0;r<this._valueCount;++r)this._delta[r]=0},t.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,a=this.surface._deformVertices,i=0;i<this._deformCount;++i){var r=0;r=i<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+i]:i<this._valueOffset+this._valueCount?this._result[i-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+i-this._valueCount],0<t?a[i]+=r*e:a[i]=1!==e?r*e:r}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},t}(d.TweenTimelineState);d.SurfaceTimelineState=s;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(0<=this.playState){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(d.SlotTimelineState);d.SlotDislayTimelineState=o;var l=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._current=[0,0,0,0,0,0,0,0],t._delta=[0,0,0,0,0,0,0,0],t._result=[0,0,0,0,0,0,0,0],t}return ot(t,n),t.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this),this._dirty=!1},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._dragonBonesData.intArray,e=this._frameIntArray,a=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,i=e[a];i<0&&(i+=65536),this._current[0]=t[i++],this._current[1]=t[i++],this._current[2]=t[i++],this._current[3]=t[i++],this._current[4]=t[i++],this._current[5]=t[i++],this._current[6]=t[i++],this._current[7]=t[i++],2===this._tweenState&&((i=this._frameIndex===this._frameCount-1?e[this._animationData.frameIntOffset+this._frameValueOffset]:e[a+1])<0&&(i+=65536),this._delta[0]=t[i++]-this._current[0],this._delta[1]=t[i++]-this._current[1],this._delta[2]=t[i++]-this._current[2],this._delta[3]=t[i++]-this._current[3],this._delta[4]=t[i++]-this._current[4],this._delta[5]=t[i++]-this._current[5],this._delta[6]=t[i++]-this._current[6],this._delta[7]=t[i++]-this._current[7])}else{var r=this.slot._slotData.color;this._current[0]=100*r.alphaMultiplier,this._current[1]=100*r.redMultiplier,this._current[2]=100*r.greenMultiplier,this._current[3]=100*r.blueMultiplier,this._current[4]=r.alphaOffset,this._current[5]=r.redOffset,this._current[6]=r.greenOffset,this._current[7]=r.blueOffset}},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},t.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},t.prototype.update=function(t){if(n.prototype.update.call(this,t),0!==this._tweenState||this._dirty){var e=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(e.alphaMultiplier!==this._result[0]||e.redMultiplier!==this._result[1]||e.greenMultiplier!==this._result[2]||e.blueMultiplier!==this._result[3]||e.alphaOffset!==this._result[4]||e.redOffset!==this._result[5]||e.greenOffset!==this._result[6]||e.blueOffset!==this._result[7]){var a=Math.pow(this._animationState._fadeProgress,4);e.alphaMultiplier+=(this._result[0]-e.alphaMultiplier)*a,e.redMultiplier+=(this._result[1]-e.redMultiplier)*a,e.greenMultiplier+=(this._result[2]-e.greenMultiplier)*a,e.blueMultiplier+=(this._result[3]-e.blueMultiplier)*a,e.alphaOffset+=(this._result[4]-e.alphaOffset)*a,e.redOffset+=(this._result[5]-e.redOffset)*a,e.greenOffset+=(this._result[6]-e.greenOffset)*a,e.blueOffset+=(this._result[7]-e.blueOffset)*a,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,e.alphaMultiplier===this._result[0]&&e.redMultiplier===this._result[1]&&e.greenMultiplier===this._result[2]&&e.blueMultiplier===this._result[3]&&e.alphaOffset===this._result[4]&&e.redOffset===this._result[5]&&e.greenOffset===this._result[6]&&e.blueOffset===this._result[7]||(e.alphaMultiplier=this._result[0],e.redMultiplier=this._result[1],e.greenMultiplier=this._result[2],e.blueMultiplier=this._result[3],e.alphaOffset=this._result[4],e.redOffset=this._result[5],e.greenOffset=this._result[6],e.blueOffset=this._result[7],this.slot._colorDirty=!0))}},t}(d.SlotTimelineState);d.SlotColorTimelineState=l;var h=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._current=[],t._delta=[],t._result=[],t}return ot(t,n),t.toString=function(){return"[class dragonBones.SlotFFDTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this),this.meshOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},t.prototype._onArriveAtFrame=function(){if(n.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,e=this._armature._armatureData.scale,a=this._frameFloatArray;if(2===this._tweenState){var i=t+this._valueCount;this._frameIndex===this._frameCount-1&&(i=this._animationData.frameFloatOffset+this._frameValueOffset);for(var r=0;r<this._valueCount;++r)this._delta[r]=a[i+r]*e-(this._current[r]=a[t+r]*e)}else for(r=0;r<this._valueCount;++r)this._current[r]=a[t+r]*e}else for(r=0;r<this._valueCount;++r)this._current[r]=0},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var t=0;t<this._valueCount;++t)this._result[t]=this._current[t]+this._delta[t]*this._tweenProgress},t.prototype.init=function(t,e,a){if(n.prototype.init.call(this,t,e,a),null!==this._timelineData){var i=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this.meshOffset=this._frameIntArray[i+0],this.meshOffset<0&&(this.meshOffset+=65536),this._deformCount=this._frameIntArray[i+1],this._valueCount=this._frameIntArray[i+2],this._valueOffset=this._frameIntArray[i+3],this._frameFloatOffset=this._frameIntArray[i+4]+this._animationData.frameFloatOffset}else this._deformCount=this.slot._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var r=0;r<this._valueCount;++r)this._delta[r]=0},t.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},t.prototype.update=function(t){if(null!==this.slot._meshData&&this.slot._meshData.offset===this.meshOffset&&(n.prototype.update.call(this,t),0!==this._tweenState||this._dirty)){var e=this.slot._deformVertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var a=Math.pow(this._animationState._fadeProgress,2),i=0;i<this._deformCount;++i)i<this._valueOffset?e[i]+=(this._frameFloatArray[this._frameFloatOffset+i]-e[i])*a:i<this._valueOffset+this._valueCount?e[i]+=(this._result[i-this._valueOffset]-e[i])*a:e[i]+=(this._frameFloatArray[this._frameFloatOffset+i-this._valueCount]-e[i])*a;this.slot._meshDirty=!0}else if(this._dirty){this._dirty=!1;for(i=0;i<this._deformCount;++i)i<this._valueOffset?e[i]=this._frameFloatArray[this._frameFloatOffset+i]:i<this._valueOffset+this._valueCount?e[i]=this._result[i-this._valueOffset]:e[i]=this._frameFloatArray[this._frameFloatOffset+i-this._valueCount];this.slot._meshDirty=!0}}},t}(d.SlotTimelineState);d.SlotFFDTimelineState=h;var u=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return ot(t,n),t.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},t.prototype._onClear=function(){n.prototype._onClear.call(this),this._current=0,this._delta=0},t.prototype._onArriveAtFrame=function(){n.prototype._onArriveAtFrame.call(this);var t=this.constraint;if(null!==this._timelineData){var e=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,a=this._frameIntArray,i=0!==a[e++];this._current=.01*a[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*a[e+1]-this._current):this._delta=0,t._bendPositive=i}else{var r=t._constraintData;this._current=r.weight,this._delta=0,t._bendPositive=r.bendPositive}t.invalidUpdate()},t.prototype._onUpdateFrame=function(){n.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var t=this.constraint;t._weight=this._current+this._delta*this._tweenProgress,t.invalidUpdate()},t}(d.ConstraintTimelineState);d.IKConstraintTimelineState=u;var _=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t._floats=[0,0,0,0,0,0],t}return ot(t,i),t.toString=function(){return"[class dragonBones.AnimationTimelineState]"},t.prototype._onClear=function(){i.prototype._onClear.call(this),this.animationState=null},t.prototype._onArriveAtFrame=function(){if(i.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,e=1/this.animationState._animationData.parent.frameRate,a=this._frameIntArray;this._floats[0]=a[t++]*e,this._floats[3]=.01*a[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=a[t++]*e-this._floats[0],this._floats[4]=.01*a[t++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},t.prototype._onUpdateFrame=function(){i.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),0<=this._floats[0]&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},t.prototype.blend=function(t){var e=this.animationState,a=e._blendState.blendWeight;0<t?(e.weight+=this._floats[5]*a,e.currentTime+=this._floats[2]*a):(e.weight=this._floats[5]*a,e.currentTime=this._floats[2]*a)},t}(d.TweenTimelineState);d.AnimationTimelineState=_}(it||(it={})),V=it||(it={}),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(V.BaseObject),V.EventObject=G,H=it||(it={}),W=function(){function u(){}return u._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},u._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},u._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;default:return 0}},u._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},u._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},u._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},u.parseDragonBonesData=function(t){return t instanceof ArrayBuffer?H.BinaryDataParser.getInstance().parseDragonBonesData(t):H.ObjectDataParser.getInstance().parseDragonBonesData(t)},u.parseTextureAtlasData=function(t,e){void 0===e&&(e=1),console.warn("已废弃");for(var a={},i=t[u.SUB_TEXTURE],r=0,n=i.length;r<n;r++){var s=i[r],o=s[u.NAME],l=new H.Rectangle,h=null;l.x=s[u.X]/e,l.y=s[u.Y]/e,l.width=s[u.WIDTH]/e,l.height=s[u.HEIGHT]/e,u.FRAME_WIDTH in s&&((h=new H.Rectangle).x=s[u.FRAME_X]/e,h.y=s[u.FRAME_Y]/e,h.width=s[u.FRAME_WIDTH]/e,h.height=s[u.FRAME_HEIGHT]/e),a[o]={region:l,frame:h,rotated:!1}}return a},u.DATA_VERSION_2_3="2.3",u.DATA_VERSION_3_0="3.0",u.DATA_VERSION_4_0="4.0",u.DATA_VERSION_4_5="4.5",u.DATA_VERSION_5_0="5.0",u.DATA_VERSION=u.DATA_VERSION_5_5="5.5",u.DATA_VERSIONS=[u.DATA_VERSION_4_0,u.DATA_VERSION_4_5,u.DATA_VERSION_5_0,u.DATA_VERSION_5_5],u.TEXTURE_ATLAS="textureAtlas",u.SUB_TEXTURE="SubTexture",u.FORMAT="format",u.IMAGE_PATH="imagePath",u.WIDTH="width",u.HEIGHT="height",u.ROTATED="rotated",u.FRAME_X="frameX",u.FRAME_Y="frameY",u.FRAME_WIDTH="frameWidth",u.FRAME_HEIGHT="frameHeight",u.DRADON_BONES="dragonBones",u.USER_DATA="userData",u.ARMATURE="armature",u.BONE="bone",u.SURFACE="surface",u.SLOT="slot",u.CONSTRAINT="constraint",u.IK="ik",u.SKIN="skin",u.DISPLAY="display",u.ANIMATION="animation",u.Z_ORDER="zOrder",u.FFD="ffd",u.FRAME="frame",u.TRANSLATE_FRAME="translateFrame",u.ROTATE_FRAME="rotateFrame",u.SCALE_FRAME="scaleFrame",u.DISPLAY_FRAME="displayFrame",u.COLOR_FRAME="colorFrame",u.DEFAULT_ACTIONS="defaultActions",u.ACTIONS="actions",u.EVENTS="events",u.INTS="ints",u.FLOATS="floats",u.STRINGS="strings",u.CANVAS="canvas",u.TRANSFORM="transform",u.PIVOT="pivot",u.AABB="aabb",u.COLOR="color",u.VERSION="version",u.COMPATIBLE_VERSION="compatibleVersion",u.FRAME_RATE="frameRate",u.TYPE="type",u.SUB_TYPE="subType",u.NAME="name",u.PARENT="parent",u.TARGET="target",u.STAGE="stage",u.SHARE="share",u.PATH="path",u.LENGTH="length",u.DISPLAY_INDEX="displayIndex",u.BLEND_MODE="blendMode",u.INHERIT_TRANSLATION="inheritTranslation",u.INHERIT_ROTATION="inheritRotation",u.INHERIT_SCALE="inheritScale",u.INHERIT_REFLECTION="inheritReflection",u.INHERIT_ANIMATION="inheritAnimation",u.INHERIT_DEFORM="inheritDeform",u.SEGMENT_X="segmentX",u.SEGMENT_Y="segmentY",u.BEND_POSITIVE="bendPositive",u.CHAIN="chain",u.WEIGHT="weight",u.FADE_IN_TIME="fadeInTime",u.PLAY_TIMES="playTimes",u.SCALE="scale",u.OFFSET="offset",u.POSITION="position",u.DURATION="duration",u.TWEEN_EASING="tweenEasing",u.TWEEN_ROTATE="tweenRotate",u.TWEEN_SCALE="tweenScale",u.CLOCK_WISE="clockwise",u.CURVE="curve",u.SOUND="sound",u.EVENT="event",u.ACTION="action",u.X="x",u.Y="y",u.SKEW_X="skX",u.SKEW_Y="skY",u.SCALE_X="scX",u.SCALE_Y="scY",u.VALUE="value",u.ROTATE="rotate",u.SKEW="skew",u.ALPHA_OFFSET="aO",u.RED_OFFSET="rO",u.GREEN_OFFSET="gO",u.BLUE_OFFSET="bO",u.ALPHA_MULTIPLIER="aM",u.RED_MULTIPLIER="rM",u.GREEN_MULTIPLIER="gM",u.BLUE_MULTIPLIER="bM",u.UVS="uvs",u.VERTICES="vertices",u.TRIANGLES="triangles",u.WEIGHTS="weights",u.SLOT_POSE="slotPose",u.BONE_POSE="bonePose",u.GLUE_WEIGHTS="glueWeights",u.GLUE_MESHES="glueMeshes",u.GOTO_AND_PLAY="gotoAndPlay",u.DEFAULT_NAME="default",u}(),H.DataParser=W,function(G){var t=function(e){function V(){var t=null!==e&&e.apply(this,arguments)||this;return t._rawTextureAtlasIndex=0,t._rawBones=[],t._data=null,t._armature=null,t._bone=null,t._surface=null,t._slot=null,t._skin=null,t._mesh=null,t._animation=null,t._timeline=null,t._rawTextureAtlases=null,t._defaultColorOffset=-1,t._prevClockwise=0,t._prevRotation=0,t._helpMatrixA=new G.Matrix,t._helpMatrixB=new G.Matrix,t._helpTransform=new G.Transform,t._helpColorTransform=new G.ColorTransform,t._helpPoint=new G.Point,t._helpArray=[],t._intArray=[],t._floatArray=[],t._frameIntArray=[],t._frameFloatArray=[],t._frameArray=[],t._timelineArray=[],t._cacheRawMeshes=[],t._cacheMeshes=[],t._actionFrames=[],t._weightSlotPose={},t._weightBonePoses={},t._cacheBones={},t._slotChildActions={},t}return ot(V,e),V._getBoolean=function(t,e,a){if(e in t){var i=t[e],r=typeof i;if("boolean"===r)return i;if("string"!==r)return!!i;switch(i){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return a},V._getNumber=function(t,e,a){if(e in t){var i=t[e];return null===i||"NaN"===i?a:+i||0}return a},V._getString=function(t,e,a){if(e in t){var i=t[e];if("string"===typeof i){if(G.DragonBones.webAssembly)for(var r=0,n=i.length;r<n;++r)if(255<i.charCodeAt(r))return encodeURI(i);return i}return String(i)}return a},V.prototype._getCurvePoint=function(t,e,a,i,r,n,s,o,l,h){var u=1-l,_=u*u,f=l*l,m=u*_,c=3*l*_,p=3*u*f,d=l*f;h.x=m*t+c*a+p*r+d*s,h.y=m*e+c*i+p*n+d*o},V.prototype._samplingEasingCurve=function(t,e){for(var a=t.length,i=-2,r=0,n=e.length;r<n;++r){for(var s=(r+1)/(n+1);(i+6<a?t[i+6]:1)<s;)i+=6;for(var o=0<=i&&i+6<a,l=o?t[i]:0,h=o?t[i+1]:0,u=t[i+2],_=t[i+3],f=t[i+4],m=t[i+5],c=o?t[i+6]:1,p=o?t[i+7]:1,d=0,y=1;1e-4<y-d;){var g=.5*(y+d);this._getCurvePoint(l,h,u,_,f,m,c,p,g,this._helpPoint),0<s-this._helpPoint.x?d=g:y=g}e[r]=this._helpPoint.y}},V.prototype._parseActionDataInFrame=function(t,e,a,i){G.DataParser.EVENT in t&&this._mergeActionFrame(t[G.DataParser.EVENT],e,10,a,i),G.DataParser.SOUND in t&&this._mergeActionFrame(t[G.DataParser.SOUND],e,11,a,i),G.DataParser.ACTION in t&&this._mergeActionFrame(t[G.DataParser.ACTION],e,0,a,i),G.DataParser.EVENTS in t&&this._mergeActionFrame(t[G.DataParser.EVENTS],e,10,a,i),G.DataParser.ACTIONS in t&&this._mergeActionFrame(t[G.DataParser.ACTIONS],e,0,a,i)},V.prototype._mergeActionFrame=function(t,e,a,i,r){for(var n=G.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,s=this._parseActionData(t,a,i,r),o=0,l=null,h=0,u=s;h<u.length;h++){var _=u[h];this._armature.addAction(_,!1)}0===this._actionFrames.length&&((l=new b).frameStart=0,this._actionFrames.push(l),l=null);for(var f=0,m=this._actionFrames;f<m.length;f++){var c=m[f];if(c.frameStart===e){l=c;break}if(c.frameStart>e)break;o++}null===l&&((l=new b).frameStart=e,this._actionFrames.splice(o+1,0,l));for(var p=0;p<s.length;++p)l.actions.push(n+p)},V.prototype._parseArmature=function(t,e){var a=G.BaseObject.borrowObject(G.ArmatureData);if(a.name=V._getString(t,G.DataParser.NAME,""),a.frameRate=V._getNumber(t,G.DataParser.FRAME_RATE,this._data.frameRate),a.scale=e,G.DataParser.TYPE in t&&"string"==typeof t[G.DataParser.TYPE]?a.type=G.DataParser._getArmatureType(t[G.DataParser.TYPE]):a.type=V._getNumber(t,G.DataParser.TYPE,0),0===a.frameRate&&(a.frameRate=24),this._armature=a,G.DataParser.CANVAS in t){var i=t[G.DataParser.CANVAS],r=G.BaseObject.borrowObject(G.CanvasData);G.DataParser.COLOR in i?r.hasBackground=!0:r.hasBackground=!1,r.color=V._getNumber(i,G.DataParser.COLOR,0),r.x=V._getNumber(i,G.DataParser.X,0)*a.scale,r.y=V._getNumber(i,G.DataParser.Y,0)*a.scale,r.width=V._getNumber(i,G.DataParser.WIDTH,0)*a.scale,r.height=V._getNumber(i,G.DataParser.HEIGHT,0)*a.scale,a.canvas=r}if(G.DataParser.AABB in t){var n=t[G.DataParser.AABB];a.aabb.x=V._getNumber(n,G.DataParser.X,0)*a.scale,a.aabb.y=V._getNumber(n,G.DataParser.Y,0)*a.scale,a.aabb.width=V._getNumber(n,G.DataParser.WIDTH,0)*a.scale,a.aabb.height=V._getNumber(n,G.DataParser.HEIGHT,0)*a.scale}if(G.DataParser.BONE in t)for(var s=0,o=t[G.DataParser.BONE];s<o.length;s++){var l=o[s],h=V._getString(l,G.DataParser.PARENT,""),u=this._parseBone(l);if(0<h.length){var _=a.getBone(h);null!==_?u.parent=_:(h in this._cacheBones||(this._cacheBones[h]=[]),this._cacheBones[h].push(u))}if(u.name in this._cacheBones){for(var f=0,m=this._cacheBones[u.name];f<m.length;f++){m[f].parent=u}delete this._cacheBones[u.name]}a.addBone(u),this._rawBones.push(u)}if(G.DataParser.IK in t)for(var c=0,p=t[G.DataParser.IK];c<p.length;c++){var d=p[c],y=this._parseIKConstraint(d);y&&a.addConstraint(y)}if(a.sortBones(),G.DataParser.SLOT in t)for(var g=0,D=0,v=t[G.DataParser.SLOT];D<v.length;D++){var b=v[D];a.addSlot(this._parseSlot(b,g++))}if(G.DataParser.SKIN in t)for(var T=0,A=t[G.DataParser.SKIN];T<A.length;T++){var P=A[T];a.addSkin(this._parseSkin(P))}for(var S=0,x=this._cacheRawMeshes.length;S<x;++S){var O=this._cacheRawMeshes[S];G.DataParser.GLUE_WEIGHTS in O&&G.DataParser.GLUE_MESHES in O&&this._parseMeshGlue(O,this._cacheMeshes[S])}for(S=0,x=this._cacheRawMeshes.length;S<x;++S){var M=this._cacheRawMeshes[S],w=V._getString(M,G.DataParser.SHARE,"");if(0!==w.length){var I=V._getString(M,G.DataParser.SKIN,G.DataParser.DEFAULT_NAME);0===I.length&&(I=G.DataParser.DEFAULT_NAME);var E=a.getMesh(I,"",w);if(null!==E){var B=this._cacheMeshes[S];B.offset=E.offset,B.weight=E.weight,B.glue=E.glue}}}if(G.DataParser.ANIMATION in t)for(var C=0,F=t[G.DataParser.ANIMATION];C<F.length;C++){var R=F[C],N=this._parseAnimation(R);a.addAnimation(N)}if(G.DataParser.DEFAULT_ACTIONS in t)for(var k=0,j=this._parseActionData(t[G.DataParser.DEFAULT_ACTIONS],0,null,null);k<j.length;k++){var L=j[k];if(a.addAction(L,!0),0===L.type)null!==(N=a.getAnimation(L.name))&&(a.defaultAnimation=N)}if(G.DataParser.ACTIONS in t)for(var U=0,Y=this._parseActionData(t[G.DataParser.ACTIONS],0,null,null);U<Y.length;U++){L=Y[U];a.addAction(L,!1)}for(var X in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[X];for(var X in this._weightBonePoses)delete this._weightBonePoses[X];for(var X in this._cacheBones)delete this._cacheBones[X];for(var X in this._slotChildActions)delete this._slotChildActions[X];return a},V.prototype._parseBone=function(t){var e=this._armature.scale;if(0===(G.DataParser.TYPE in t&&"string"==typeof t[G.DataParser.TYPE]?G.DataParser._getBoneType(t[G.DataParser.TYPE]):V._getNumber(t,G.DataParser.TYPE,0))){var a=G.BaseObject.borrowObject(G.BoneData);return a.inheritTranslation=V._getBoolean(t,G.DataParser.INHERIT_TRANSLATION,!0),a.inheritRotation=V._getBoolean(t,G.DataParser.INHERIT_ROTATION,!0),a.inheritScale=V._getBoolean(t,G.DataParser.INHERIT_SCALE,!0),a.inheritReflection=V._getBoolean(t,G.DataParser.INHERIT_REFLECTION,!0),a.length=V._getNumber(t,G.DataParser.LENGTH,0)*e,a.name=V._getString(t,G.DataParser.NAME,""),G.DataParser.TRANSFORM in t&&this._parseTransform(t[G.DataParser.TRANSFORM],a.transform,e),a}var i=G.BaseObject.borrowObject(G.SurfaceData);if(i.name=V._getString(t,G.DataParser.NAME,""),i.segmentX=V._getNumber(t,G.DataParser.SEGMENT_X,0),i.segmentY=V._getNumber(t,G.DataParser.SEGMENT_Y,0),i.vertices.length=(i.segmentX+1)*(i.segmentY+1)*2,G.DataParser.VERTICES in t)for(var r=t[G.DataParser.VERTICES],n=0,s=i.vertices.length;n<s;++n)n<r.length?i.vertices[n]=r[n]*e:i.vertices[n]=0;return i},V.prototype._parseIKConstraint=function(t){var e=this._armature.getBone(V._getString(t,G.DataParser.BONE,""));if(null===e)return null;var a=this._armature.getBone(V._getString(t,G.DataParser.TARGET,""));if(null===a)return null;var i=G.BaseObject.borrowObject(G.IKConstraintData);return i.scaleEnabled=V._getBoolean(t,G.DataParser.SCALE,!1),i.bendPositive=V._getBoolean(t,G.DataParser.BEND_POSITIVE,!0),i.weight=V._getNumber(t,G.DataParser.WEIGHT,1),i.name=V._getString(t,G.DataParser.NAME,""),i.target=a,0<V._getNumber(t,G.DataParser.CHAIN,0)&&null!==e.parent?(i.root=e.parent,i.bone=e):(i.root=e,i.bone=null),i},V.prototype._parseSlot=function(t,e){var a=G.BaseObject.borrowObject(G.SlotData);return a.displayIndex=V._getNumber(t,G.DataParser.DISPLAY_INDEX,0),a.zOrder=e,a.name=V._getString(t,G.DataParser.NAME,""),a.parent=this._armature.getBone(V._getString(t,G.DataParser.PARENT,"")),G.DataParser.BLEND_MODE in t&&"string"==typeof t[G.DataParser.BLEND_MODE]?a.blendMode=G.DataParser._getBlendMode(t[G.DataParser.BLEND_MODE]):a.blendMode=V._getNumber(t,G.DataParser.BLEND_MODE,0),G.DataParser.COLOR in t?(a.color=G.SlotData.createColor(),this._parseColorTransform(t[G.DataParser.COLOR],a.color)):a.color=G.SlotData.DEFAULT_COLOR,G.DataParser.ACTIONS in t&&(this._slotChildActions[a.name]=this._parseActionData(t[G.DataParser.ACTIONS],0,null,null)),a},V.prototype._parseSkin=function(t){var e=G.BaseObject.borrowObject(G.SkinData);if(e.name=V._getString(t,G.DataParser.NAME,G.DataParser.DEFAULT_NAME),0===e.name.length&&(e.name=G.DataParser.DEFAULT_NAME),G.DataParser.SLOT in t){var a=t[G.DataParser.SLOT];this._skin=e;for(var i=0,r=a;i<r.length;i++){var n=r[i],s=V._getString(n,G.DataParser.NAME,""),o=this._armature.getSlot(s);if(null!==o){if(this._slot=o,G.DataParser.DISPLAY in n)for(var l=0,h=n[G.DataParser.DISPLAY];l<h.length;l++){var u=h[l];u?e.addDisplay(s,this._parseDisplay(u)):e.addDisplay(s,null)}this._slot=null}}this._skin=null}return e},V.prototype._parseDisplay=function(t){var e=V._getString(t,G.DataParser.NAME,""),a=V._getString(t,G.DataParser.PATH,""),i=0,r=null;switch(i=G.DataParser.TYPE in t&&"string"==typeof t[G.DataParser.TYPE]?G.DataParser._getDisplayType(t[G.DataParser.TYPE]):V._getNumber(t,G.DataParser.TYPE,i)){case 0:var n=r=G.BaseObject.borrowObject(G.ImageDisplayData);n.name=e,n.path=0<a.length?a:e,this._parsePivot(t,n);break;case 1:var s=r=G.BaseObject.borrowObject(G.ArmatureDisplayData);if(s.name=e,s.path=0<a.length?a:e,s.inheritAnimation=!0,G.DataParser.ACTIONS in t)for(var o=0,l=this._parseActionData(t[G.DataParser.ACTIONS],0,null,null);o<l.length;o++){var h=l[o];s.addAction(h)}else if(this._slot.name in this._slotChildActions){var u=this._skin.getDisplays(this._slot.name);if(null===u?0===this._slot.displayIndex:this._slot.displayIndex===u.length){for(var _=0,f=this._slotChildActions[this._slot.name];_<f.length;_++){h=f[_];s.addAction(h)}delete this._slotChildActions[this._slot.name]}}break;case 2:var m=r=G.BaseObject.borrowObject(G.MeshDisplayData);m.inheritDeform=V._getBoolean(t,G.DataParser.INHERIT_DEFORM,!0),m.name=e,m.path=0<a.length?a:e,G.DataParser.SHARE in t?(this._cacheRawMeshes.push(t),this._cacheRawMeshes.push(m)):this._parseMesh(t,m),G.DataParser.GLUE_WEIGHTS in t&&G.DataParser.GLUE_MESHES in t&&(this._cacheRawMeshes.push(t),this._cacheRawMeshes.push(m));break;case 3:var c=this._parseBoundingBox(t);if(null!==c){var p=r=G.BaseObject.borrowObject(G.BoundingBoxDisplayData);p.name=e,p.path=0<a.length?a:e,p.boundingBox=c}}return null!==r&&G.DataParser.TRANSFORM in t&&this._parseTransform(t[G.DataParser.TRANSFORM],r.transform,this._armature.scale),r},V.prototype._parsePivot=function(t,e){if(G.DataParser.PIVOT in t){var a=t[G.DataParser.PIVOT];e.pivot.x=V._getNumber(a,G.DataParser.X,0),e.pivot.y=V._getNumber(a,G.DataParser.Y,0)}else e.pivot.x=.5,e.pivot.y=.5},V.prototype._parseMesh=function(t,e){var a=t[G.DataParser.VERTICES],i=t[G.DataParser.UVS],r=t[G.DataParser.TRIANGLES],n=Math.floor(a.length/2),s=Math.floor(r.length/3),o=this._floatArray.length,l=o+2*n,h=this._intArray.length,u=this._skin.name+"_"+this._slot.name+"_"+e.name;e.offset=h,this._intArray.length+=4+3*s,this._intArray[h+0]=n,this._intArray[h+1]=s,this._intArray[h+2]=o;for(var _=0,f=3*s;_<f;++_)this._intArray[h+4+_]=r[_];this._floatArray.length+=2*n+2*n;for(_=0,f=2*n;_<f;++_)this._floatArray[o+_]=a[_],this._floatArray[l+_]=i[_];if(G.DataParser.WEIGHTS in t){var m=t[G.DataParser.WEIGHTS],c=t[G.DataParser.SLOT_POSE],p=t[G.DataParser.BONE_POSE],d=this._armature.sortedBones,y=new Array,g=Math.floor(p.length/7),D=this._floatArray.length,v=Math.floor(m.length-n)/2,b=this._intArray.length,T=G.BaseObject.borrowObject(G.WeightData);T.count=v,T.offset=b,y.length=g,this._intArray.length+=2+g+n+v,this._intArray[b+1]=D;for(_=0;_<g;++_){var A=p[7*_],P=this._rawBones[A];T.addBone(P),y[_]=A,this._intArray[b+2+_]=d.indexOf(P)}this._floatArray.length+=3*v,this._helpMatrixA.copyFromArray(c,0);_=0;for(var S=0,x=b+2+g,O=D;_<n;++_){var M=2*_,w=this._intArray[x++]=m[S++],I=this._floatArray[o+M],E=this._floatArray[o+M+1];this._helpMatrixA.transformPoint(I,E,this._helpPoint),I=this._helpPoint.x,E=this._helpPoint.y;for(var B=0;B<w;++B){A=m[S++];var C=y.indexOf(A);this._helpMatrixB.copyFromArray(p,7*C+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(I,E,this._helpPoint),this._intArray[x++]=C,this._floatArray[O++]=m[S++],this._floatArray[O++]=this._helpPoint.x,this._floatArray[O++]=this._helpPoint.y}}e.weight=T,this._weightSlotPose[u]=c,this._weightBonePoses[u]=p}},V.prototype._parseMeshGlue=function(t,e){var a=t[G.DataParser.GLUE_WEIGHTS],i=t[G.DataParser.GLUE_MESHES];e.glue=G.BaseObject.borrowObject(G.GlueData),e.glue.weights.length=a.length;for(var r=0,n=a.length;r<n;++r)e.glue.weights[r]=a[r];for(r=0,n=i.length;r<n;r+=3){var s=this._armature.getMesh(i[r],i[r+1],i[r+2]);e.glue.addMesh(s)}},V.prototype._parseBoundingBox=function(t){var e=null,a=0;switch(a=G.DataParser.SUB_TYPE in t&&"string"==typeof t[G.DataParser.SUB_TYPE]?G.DataParser._getBoundingBoxType(t[G.DataParser.SUB_TYPE]):V._getNumber(t,G.DataParser.SUB_TYPE,a)){case 0:e=G.BaseObject.borrowObject(G.RectangleBoundingBoxData);break;case 1:e=G.BaseObject.borrowObject(G.EllipseBoundingBoxData);break;case 2:e=this._parsePolygonBoundingBox(t)}return null!==e&&(e.color=V._getNumber(t,G.DataParser.COLOR,0),0!==e.type&&1!==e.type||(e.width=V._getNumber(t,G.DataParser.WIDTH,0),e.height=V._getNumber(t,G.DataParser.HEIGHT,0))),e},V.prototype._parsePolygonBoundingBox=function(t){var e=G.BaseObject.borrowObject(G.PolygonBoundingBoxData);if(G.DataParser.VERTICES in t){var a=this._armature.scale,i=t[G.DataParser.VERTICES],r=e.vertices;G.DragonBones.webAssembly?r.resize(i.length,0):r.length=i.length;for(var n=0,s=i.length;n<s;n+=2){var o=i[n]*a,l=i[n+1]*a;G.DragonBones.webAssembly?(r.set(n,o),r.set(n+1,l)):(r[n]=o,r[n+1]=l),0===n?(e.x=o,e.y=l,e.width=o,e.height=l):(o<e.x?e.x=o:o>e.width&&(e.width=o),l<e.y?e.y=l:l>e.height&&(e.height=l))}e.width-=e.x,e.height-=e.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return e},V.prototype._parseAnimation=function(t){var e=G.BaseObject.borrowObject(G.AnimationData);if(e.frameCount=Math.max(V._getNumber(t,G.DataParser.DURATION,1),1),e.playTimes=V._getNumber(t,G.DataParser.PLAY_TIMES,1),e.duration=e.frameCount/this._armature.frameRate,e.fadeInTime=V._getNumber(t,G.DataParser.FADE_IN_TIME,0),e.scale=V._getNumber(t,G.DataParser.SCALE,1),e.name=V._getString(t,G.DataParser.NAME,G.DataParser.DEFAULT_NAME),0===e.name.length&&(e.name=G.DataParser.DEFAULT_NAME),e.frameIntOffset=this._frameIntArray.length,e.frameFloatOffset=this._frameFloatArray.length,e.frameOffset=this._frameArray.length,this._animation=e,G.DataParser.FRAME in t){var a=t[G.DataParser.FRAME],i=a.length;if(0<i)for(var r=0,n=0;r<i;++r){var s=a[r];this._parseActionDataInFrame(s,n,null,null),n+=V._getNumber(s,G.DataParser.DURATION,1)}}if(G.DataParser.Z_ORDER in t&&(this._animation.zOrderTimeline=this._parseTimeline(t[G.DataParser.Z_ORDER],null,G.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),G.DataParser.BONE in t)for(var o=0,l=t[G.DataParser.BONE];o<l.length;o++){var h=l[o];this._parseBoneTimeline(h)}if(G.DataParser.SURFACE in t)for(var u=0,_=t[G.DataParser.SURFACE];u<_.length;u++){h=_[u];var f=V._getString(h,G.DataParser.NAME,"");if(this._surface=this._armature.getBone(f),null!==this._surface)null!==(x=this._parseTimeline(h,null,G.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,x),this._surface=null}if(G.DataParser.SLOT in t)for(var m=0,c=t[G.DataParser.SLOT];m<c.length;m++){h=c[m];this._parseSlotTimeline(h)}if(G.DataParser.FFD in t)for(var p=0,d=t[G.DataParser.FFD];p<d.length;p++){h=d[p];var y=V._getString(h,G.DataParser.SKIN,G.DataParser.DEFAULT_NAME),g=V._getString(h,G.DataParser.SLOT,""),D=V._getString(h,G.DataParser.NAME,"");if(0===y.length&&(y=G.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(g),this._mesh=this._armature.getMesh(y,g,D),null!==this._slot&&null!==this._mesh)null!==(x=this._parseTimeline(h,null,G.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,x),this._slot=null,this._mesh=null}if(G.DataParser.IK in t)for(var v=0,b=t[G.DataParser.IK];v<b.length;v++){h=b[v];var T=V._getString(h,G.DataParser.NAME,""),A=this._armature.getConstraint(T);if(null!==A)null!==(x=this._parseTimeline(h,null,G.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(A,x)}if(G.DataParser.ANIMATION in t)for(var P=0,S=t[G.DataParser.ANIMATION];P<S.length;P++){h=S[P];var x,O=V._getString(h,G.DataParser.NAME,"");null!==(x=this._parseTimeline(h,null,G.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(O,x)}return 0<this._actionFrames.length&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,e},V.prototype._parseTimeline=function(t,e,a,i,r,n,s,o){if(null!==t&&0<a.length&&a in t&&(e=t[a]),null===e)return null;var l=e.length;if(0===l)return null;var h=this._frameIntArray.length,u=this._frameFloatArray.length,_=G.BaseObject.borrowObject(G.TimelineData),f=this._timelineArray.length;if(this._timelineArray.length+=5+l,null!==t?(this._timelineArray[f+0]=Math.round(100*V._getNumber(t,G.DataParser.SCALE,1)),this._timelineArray[f+1]=Math.round(100*V._getNumber(t,G.DataParser.OFFSET,0))):(this._timelineArray[f+0]=100,this._timelineArray[f+1]=0),this._timelineArray[f+2]=l,this._timelineArray[f+3]=s,this._timelineArray[f+4]=r?h-this._animation.frameIntOffset:n?u-this._animation.frameFloatOffset:0,(this._timeline=_).type=i,_.offset=f,1===l)_.frameIndicesOffset=-1,this._timelineArray[f+5+0]=o.call(this,e[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,c=this._data.frameIndices,p=0;G.DragonBones.webAssembly?(p=c.size(),c.resize(p+m,0)):(p=c.length,c.length+=m),_.frameIndicesOffset=p;for(var d=0,y=0,g=0,D=0;d<m;++d){if(g+D<=d&&y<l){var v=e[y];g=d,D=y===l-1?this._animation.frameCount-g:v instanceof b?this._actionFrames[y+1].frameStart-g:V._getNumber(v,G.DataParser.DURATION,1),this._timelineArray[f+5+y]=o.call(this,v,g,D)-this._animation.frameOffset,y++}G.DragonBones.webAssembly?c.set(p+d,y-1):c[p+d]=y-1}}return this._timeline=null,_},V.prototype._parseBoneTimeline=function(t){var e=this._armature.getBone(V._getString(t,G.DataParser.NAME,""));if(null!==e){var a;if(this._bone=e,this._slot=this._armature.getSlot(this._bone.name),G.DataParser.TRANSLATE_FRAME in t)null!==(a=this._parseTimeline(t,null,G.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(e,a);if(G.DataParser.ROTATE_FRAME in t)null!==(a=this._parseTimeline(t,null,G.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(e,a);if(G.DataParser.SCALE_FRAME in t)null!==(a=this._parseTimeline(t,null,G.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(e,a);if(G.DataParser.FRAME in t)null!==(a=this._parseTimeline(t,null,G.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(e,a);this._bone=null,this._slot=null}},V.prototype._parseSlotTimeline=function(t){var e=this._armature.getSlot(V._getString(t,G.DataParser.NAME,""));if(null!==e){this._slot=e;var a=null;null!==(a=G.DataParser.DISPLAY_FRAME in t?this._parseTimeline(t,null,G.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(t,null,G.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(e,a);var i=null;null!==(i=G.DataParser.COLOR_FRAME in t?this._parseTimeline(t,null,G.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(t,null,G.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(e,i),this._slot=null}},V.prototype._parseFrame=function(t,e,a){var i=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[i+0]=e,i},V.prototype._parseTweenFrame=function(t,e,a){var i=this._parseFrame(t,e,a);if(0<a)if(G.DataParser.CURVE in t){var r=a+1;this._helpArray.length=r,this._samplingEasingCurve(t[G.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[i+1]=2,this._frameArray[i+2]=r;for(var n=0;n<r;++n)this._frameArray[i+3+n]=Math.round(1e4*this._helpArray[n])}else{var s=-2;G.DataParser.TWEEN_EASING in t&&(s=V._getNumber(t,G.DataParser.TWEEN_EASING,-2)),-2===s?(this._frameArray.length+=1,this._frameArray[i+1]=0):0===s?(this._frameArray.length+=1,this._frameArray[i+1]=1):s<0?(this._frameArray.length+=2,this._frameArray[i+1]=3,this._frameArray[i+2]=Math.round(100*-s)):s<=1?(this._frameArray.length+=2,this._frameArray[i+1]=4,this._frameArray[i+2]=Math.round(100*s)):(this._frameArray.length+=2,this._frameArray[i+1]=5,this._frameArray[i+2]=Math.round(100*s-100))}else this._frameArray.length+=1,this._frameArray[i+1]=0;return i},V.prototype._parseActionFrame=function(t,e,a){var i=this._frameArray.length,r=t.actions.length;this._frameArray.length+=2+r,this._frameArray[i+0]=e,this._frameArray[i+0+1]=r;for(var n=0;n<r;++n)this._frameArray[i+0+2+n]=t.actions[n];return i},V.prototype._parseZOrderFrame=function(t,e,a){var i=this._parseFrame(t,e,a);if(G.DataParser.Z_ORDER in t){var r=t[G.DataParser.Z_ORDER];if(0<r.length){for(var n=this._armature.sortedSlots.length,s=new Array(n-r.length/2),o=new Array(n),l=0;l<s.length;++l)s[l]=0;for(var h=0;h<n;++h)o[h]=-1;for(var u=0,_=0,f=0,m=r.length;f<m;f+=2){for(var c=r[f],p=r[f+1];u!==c;)s[_++]=u++;o[u+p]=u++}for(;u<n;)s[_++]=u++;this._frameArray.length+=1+n;for(var d=this._frameArray[i+1]=n;d--;)-1===o[d]?this._frameArray[i+2+d]=s[--_]||0:this._frameArray[i+2+d]=o[d]||0;return i}}return this._frameArray.length+=1,this._frameArray[i+1]=0,i},V.prototype._parseBoneAllFrame=function(t,e,a){this._helpTransform.identity(),G.DataParser.TRANSFORM in t&&this._parseTransform(t[G.DataParser.TRANSFORM],this._helpTransform,1);var i=this._helpTransform.rotation;0!==e&&(0===this._prevClockwise?i=this._prevRotation+G.Transform.normalizeRadian(i-this._prevRotation):((0<this._prevClockwise?i>=this._prevRotation:i<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),i=this._prevRotation+i-this._prevRotation+G.Transform.PI_D*this._prevClockwise)),this._prevClockwise=V._getNumber(t,G.DataParser.TWEEN_ROTATE,0),this._prevRotation=i;var r=this._parseTweenFrame(t,e,a),n=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[n++]=this._helpTransform.x,this._frameFloatArray[n++]=this._helpTransform.y,this._frameFloatArray[n++]=i,this._frameFloatArray[n++]=this._helpTransform.skew,this._frameFloatArray[n++]=this._helpTransform.scaleX,this._frameFloatArray[n++]=this._helpTransform.scaleY,this._parseActionDataInFrame(t,e,this._bone,this._slot),r},V.prototype._parseBoneTranslateFrame=function(t,e,a){var i=this._parseTweenFrame(t,e,a),r=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[r++]=V._getNumber(t,G.DataParser.X,0),this._frameFloatArray[r++]=V._getNumber(t,G.DataParser.Y,0),i},V.prototype._parseBoneRotateFrame=function(t,e,a){var i=V._getNumber(t,G.DataParser.ROTATE,0)*G.Transform.DEG_RAD;0!==e&&(0===this._prevClockwise?i=this._prevRotation+G.Transform.normalizeRadian(i-this._prevRotation):((0<this._prevClockwise?i>=this._prevRotation:i<=this._prevRotation)&&(this._prevClockwise=0<this._prevClockwise?this._prevClockwise-1:this._prevClockwise+1),i=this._prevRotation+i-this._prevRotation+G.Transform.PI_D*this._prevClockwise)),this._prevClockwise=V._getNumber(t,G.DataParser.CLOCK_WISE,0),this._prevRotation=i;var r=this._parseTweenFrame(t,e,a),n=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[n++]=i,this._frameFloatArray[n++]=V._getNumber(t,G.DataParser.SKEW,0)*G.Transform.DEG_RAD,r},V.prototype._parseBoneScaleFrame=function(t,e,a){var i=this._parseTweenFrame(t,e,a),r=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[r++]=V._getNumber(t,G.DataParser.X,1),this._frameFloatArray[r++]=V._getNumber(t,G.DataParser.Y,1),i},V.prototype._parseSurfaceFrame=function(t,e,a){var i=this._frameFloatArray.length,r=this._parseTweenFrame(t,e,a),n=t[G.DataParser.VERTICES],s=V._getNumber(t,G.DataParser.OFFSET,0),o=this._surface.vertices.length/2,l=0,h=0;this._frameFloatArray.length+=2*o;for(var u=0;u<2*o;u+=2)l=u<s||u-s>=n.length?0:n[u-s],h=u+1<s||u+1-s>=n.length?0:n[u+1-s],this._frameFloatArray[i+u]=l,this._frameFloatArray[i+u+1]=h;if(0===e){var _=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[_+0]=0,this._frameIntArray[_+1]=this._frameFloatArray.length-i,this._frameIntArray[_+2]=this._frameFloatArray.length-i,this._frameIntArray[_+3]=0,this._frameIntArray[_+4]=i-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=_-this._animation.frameIntOffset}return r},V.prototype._parseSlotDisplayFrame=function(t,e,a){var i=this._parseFrame(t,e,a);return this._frameArray.length+=1,G.DataParser.VALUE in t?this._frameArray[i+1]=V._getNumber(t,G.DataParser.VALUE,0):this._frameArray[i+1]=V._getNumber(t,G.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(t,e,this._slot.parent,this._slot),i},V.prototype._parseSlotColorFrame=function(t,e,a){var i=this._parseTweenFrame(t,e,a),r=-1;if(G.DataParser.VALUE in t||G.DataParser.COLOR in t){var n=G.DataParser.VALUE in t?t[G.DataParser.VALUE]:t[G.DataParser.COLOR];for(var s in n){this._parseColorTransform(n,this._helpColorTransform),r=this._intArray.length,this._intArray.length+=8,this._intArray[r++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[r++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[r++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[r++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[r++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[r++]=Math.round(this._helpColorTransform.redOffset),this._intArray[r++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[r++]=Math.round(this._helpColorTransform.blueOffset),r-=8;break}}r<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=r=this._intArray.length,this._intArray.length+=8,this._intArray[r++]=100,this._intArray[r++]=100,this._intArray[r++]=100,this._intArray[r++]=100,this._intArray[r++]=0,this._intArray[r++]=0,this._intArray[r++]=0,this._intArray[r++]=0),r=this._defaultColorOffset);var o=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[o]=r,i},V.prototype._parseSlotFFDFrame=function(t,e,a){var i=this._frameFloatArray.length,r=this._parseTweenFrame(t,e,a),n=G.DataParser.VERTICES in t?t[G.DataParser.VERTICES]:null,s=V._getNumber(t,G.DataParser.OFFSET,0),o=this._intArray[this._mesh.offset+0],l=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,h=0,u=0,_=0,f=0;if(null!==this._mesh.weight){var m=this._weightSlotPose[l];this._helpMatrixA.copyFromArray(m,0),this._frameFloatArray.length+=2*this._mesh.weight.count,_=this._mesh.weight.offset+2+this._mesh.weight.bones.length}else this._frameFloatArray.length+=2*o;for(var c=0;c<2*o;c+=2)if(null===n?u=h=0:(h=c<s||c-s>=n.length?0:n[c-s],u=c+1<s||c+1-s>=n.length?0:n[c+1-s]),null!==this._mesh.weight){var p=this._weightBonePoses[l],d=this._intArray[_++];this._helpMatrixA.transformPoint(h,u,this._helpPoint,!0),h=this._helpPoint.x,u=this._helpPoint.y;for(var y=0;y<d;++y){var g=this._intArray[_++];this._helpMatrixB.copyFromArray(p,7*g+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(h,u,this._helpPoint,!0),this._frameFloatArray[i+f++]=this._helpPoint.x,this._frameFloatArray[i+f++]=this._helpPoint.y}}else this._frameFloatArray[i+c]=h,this._frameFloatArray[i+c+1]=u;if(0===e){var D=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[D+0]=this._mesh.offset,this._frameIntArray[D+1]=this._frameFloatArray.length-i,this._frameIntArray[D+2]=this._frameFloatArray.length-i,this._frameIntArray[D+3]=0,this._frameIntArray[D+4]=i-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=D-this._animation.frameIntOffset}return r},V.prototype._parseIKConstraintFrame=function(t,e,a){var i=this._parseTweenFrame(t,e,a),r=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[r++]=V._getBoolean(t,G.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[r++]=Math.round(100*V._getNumber(t,G.DataParser.WEIGHT,1)),i},V.prototype._parseAnimationFrame=function(t,e,a){var i=this._parseTweenFrame(t,e,a),r=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[r++]=V._getNumber(t,G.DataParser.VALUE,0),this._frameIntArray[r++]=Math.round(100*V._getNumber(t,G.DataParser.WEIGHT,1)),i},V.prototype._parseActionData=function(t,e,a,i){var r=new Array;if("string"==typeof t)(l=G.BaseObject.borrowObject(G.ActionData)).type=e,l.name=t,l.bone=a,l.slot=i,r.push(l);else if(t instanceof Array)for(var n=0,s=t;n<s.length;n++){var o=s[n],l=G.BaseObject.borrowObject(G.ActionData);if(G.DataParser.GOTO_AND_PLAY in o?(l.type=0,l.name=V._getString(o,G.DataParser.GOTO_AND_PLAY,"")):(G.DataParser.TYPE in o&&"string"==typeof o[G.DataParser.TYPE]?l.type=G.DataParser._getActionType(o[G.DataParser.TYPE]):l.type=V._getNumber(o,G.DataParser.TYPE,e),l.name=V._getString(o,G.DataParser.NAME,"")),G.DataParser.BONE in o){var h=V._getString(o,G.DataParser.BONE,"");l.bone=this._armature.getBone(h)}else l.bone=a;if(G.DataParser.SLOT in o){var u=V._getString(o,G.DataParser.SLOT,"");l.slot=this._armature.getSlot(u)}else l.slot=i;var _=null;if(G.DataParser.INTS in o){null===_&&(_=G.BaseObject.borrowObject(G.UserData));for(var f=0,m=o[G.DataParser.INTS];f<m.length;f++){var c=m[f];_.addInt(c)}}if(G.DataParser.FLOATS in o){null===_&&(_=G.BaseObject.borrowObject(G.UserData));for(var p=0,d=o[G.DataParser.FLOATS];p<d.length;p++){c=d[p];_.addFloat(c)}}if(G.DataParser.STRINGS in o){null===_&&(_=G.BaseObject.borrowObject(G.UserData));for(var y=0,g=o[G.DataParser.STRINGS];y<g.length;y++){c=g[y];_.addString(c)}}l.data=_,r.push(l)}return r},V.prototype._parseTransform=function(t,e,a){e.x=V._getNumber(t,G.DataParser.X,0)*a,e.y=V._getNumber(t,G.DataParser.Y,0)*a,G.DataParser.ROTATE in t||G.DataParser.SKEW in t?(e.rotation=G.Transform.normalizeRadian(V._getNumber(t,G.DataParser.ROTATE,0)*G.Transform.DEG_RAD),e.skew=G.Transform.normalizeRadian(V._getNumber(t,G.DataParser.SKEW,0)*G.Transform.DEG_RAD)):(G.DataParser.SKEW_X in t||G.DataParser.SKEW_Y in t)&&(e.rotation=G.Transform.normalizeRadian(V._getNumber(t,G.DataParser.SKEW_Y,0)*G.Transform.DEG_RAD),e.skew=G.Transform.normalizeRadian(V._getNumber(t,G.DataParser.SKEW_X,0)*G.Transform.DEG_RAD)-e.rotation),e.scaleX=V._getNumber(t,G.DataParser.SCALE_X,1),e.scaleY=V._getNumber(t,G.DataParser.SCALE_Y,1)},V.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=.01*V._getNumber(t,G.DataParser.ALPHA_MULTIPLIER,100),e.redMultiplier=.01*V._getNumber(t,G.DataParser.RED_MULTIPLIER,100),e.greenMultiplier=.01*V._getNumber(t,G.DataParser.GREEN_MULTIPLIER,100),e.blueMultiplier=.01*V._getNumber(t,G.DataParser.BLUE_MULTIPLIER,100),e.alphaOffset=V._getNumber(t,G.DataParser.ALPHA_OFFSET,0),e.redOffset=V._getNumber(t,G.DataParser.RED_OFFSET,0),e.greenOffset=V._getNumber(t,G.DataParser.GREEN_OFFSET,0),e.blueOffset=V._getNumber(t,G.DataParser.BLUE_OFFSET,0)},V.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},V.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,a=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,i=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,r=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=t+e+a+i+r+n;if(G.DragonBones.webAssembly){for(var o=G.webAssemblyModule.HEAP16.buffer,l=G.webAssemblyModule._malloc(s),h=new Int16Array(o,l,this._intArray.length),u=new Float32Array(o,l+t,this._floatArray.length),_=new Int16Array(o,l+t+e,this._frameIntArray.length),f=new Float32Array(o,l+t+e+a,this._frameFloatArray.length),m=new Int16Array(o,l+t+e+a+i,this._frameArray.length),c=new Uint16Array(o,l+t+e+a+i+r,this._timelineArray.length),p=0,d=this._intArray.length;p<d;++p)h[p]=this._intArray[p];for(p=0,d=this._floatArray.length;p<d;++p)u[p]=this._floatArray[p];for(p=0,d=this._frameIntArray.length;p<d;++p)_[p]=this._frameIntArray[p];for(p=0,d=this._frameFloatArray.length;p<d;++p)f[p]=this._frameFloatArray[p];for(p=0,d=this._frameArray.length;p<d;++p)m[p]=this._frameArray[p];for(p=0,d=this._timelineArray.length;p<d;++p)c[p]=this._timelineArray[p];G.webAssemblyModule.setDataBinary(this._data,l,t,e,a,i,r,n)}else{var y=new ArrayBuffer(s);for(h=new Int16Array(y,0,this._intArray.length),u=new Float32Array(y,t,this._floatArray.length),_=new Int16Array(y,t+e,this._frameIntArray.length),f=new Float32Array(y,t+e+a,this._frameFloatArray.length),m=new Int16Array(y,t+e+a+i,this._frameArray.length),c=new Uint16Array(y,t+e+a+i+r,this._timelineArray.length),p=0,d=this._intArray.length;p<d;++p)h[p]=this._intArray[p];for(p=0,d=this._floatArray.length;p<d;++p)u[p]=this._floatArray[p];for(p=0,d=this._frameIntArray.length;p<d;++p)_[p]=this._frameIntArray[p];for(p=0,d=this._frameFloatArray.length;p<d;++p)f[p]=this._frameFloatArray[p];for(p=0,d=this._frameArray.length;p<d;++p)m[p]=this._frameArray[p];for(p=0,d=this._timelineArray.length;p<d;++p)c[p]=this._timelineArray[p];this._data.binary=y,this._data.intArray=h,this._data.floatArray=u,this._data.frameIntArray=_,this._data.frameFloatArray=f,this._data.frameArray=m,this._data.timelineArray=c}this._defaultColorOffset=-1},V.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=1),console.assert(null!=t,"Data error.");var a=V._getString(t,G.DataParser.VERSION,""),i=V._getString(t,G.DataParser.COMPATIBLE_VERSION,"");if(0<=G.DataParser.DATA_VERSIONS.indexOf(a)||0<=G.DataParser.DATA_VERSIONS.indexOf(i)){var r=G.BaseObject.borrowObject(G.DragonBonesData);if(r.version=a,r.name=V._getString(t,G.DataParser.NAME,""),r.frameRate=V._getNumber(t,G.DataParser.FRAME_RATE,24),0===r.frameRate&&(r.frameRate=24),G.DataParser.ARMATURE in t){this._data=r,this._parseArray(t);for(var n=0,s=t[G.DataParser.ARMATURE];n<s.length;n++){var o=s[n];r.addArmature(this._parseArmature(o,e))}this._data.binary||this._modifyArray(),G.DataParser.STAGE in t?r.stage=r.getArmature(V._getString(t,G.DataParser.STAGE,"")):0<r.armatureNames.length&&(r.stage=r.getArmature(r.armatureNames[0])),this._data=null}return G.DataParser.TEXTURE_ATLAS in t&&(this._rawTextureAtlases=t[G.DataParser.TEXTURE_ATLAS]),r}return console.assert(!1,"Nonsupport data version: "+a+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},V.prototype.parseTextureAtlasData=function(t,e,a){if(void 0===a&&(a=1),console.assert(void 0!==t),null===t){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var i=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(i,e,a),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(e.width=V._getNumber(t,G.DataParser.WIDTH,0),e.height=V._getNumber(t,G.DataParser.HEIGHT,0),e.scale=1===a?1/V._getNumber(t,G.DataParser.SCALE,1):a,e.name=V._getString(t,G.DataParser.NAME,""),e.imagePath=V._getString(t,G.DataParser.IMAGE_PATH,""),G.DataParser.SUB_TEXTURE in t)for(var r=t[G.DataParser.SUB_TEXTURE],n=0,s=r.length;n<s;++n){var o=r[n],l=e.createTexture();l.rotated=V._getBoolean(o,G.DataParser.ROTATED,!1),l.name=V._getString(o,G.DataParser.NAME,""),l.region.x=V._getNumber(o,G.DataParser.X,0),l.region.y=V._getNumber(o,G.DataParser.Y,0),l.region.width=V._getNumber(o,G.DataParser.WIDTH,0),l.region.height=V._getNumber(o,G.DataParser.HEIGHT,0);var h=V._getNumber(o,G.DataParser.FRAME_WIDTH,-1),u=V._getNumber(o,G.DataParser.FRAME_HEIGHT,-1);0<h&&0<u&&(l.frame=G.TextureData.createRectangle(),l.frame.x=V._getNumber(o,G.DataParser.FRAME_X,0),l.frame.y=V._getNumber(o,G.DataParser.FRAME_Y,0),l.frame.width=h,l.frame.height=u),e.addTexture(l)}return!0},V.getInstance=function(){return null===V._objectDataParserInstance&&(V._objectDataParserInstance=new V),V._objectDataParserInstance},V._objectDataParserInstance=null,V}(G.DataParser);G.ObjectDataParser=t;var b=function(){this.frameStart=0,this.actions=[]};G.ActionFrame=b}(it||(it={})),z=it||(it={}),K=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return ot(t,o),t.prototype._inRange=function(t,e,a){return e<=t&&t<=a},t.prototype._decodeUTF8=function(t){for(var e,a=0,i="",r=0,n=0,s=0,o=0;t.length>a;){var l=t[a++];if(-1===l)e=0!==n?65533:-1;else if(0===n)this._inRange(l,0,127)?e=l:(this._inRange(l,194,223)?(n=1,o=128,r=l-192):this._inRange(l,224,239)?(n=2,o=2048,r=l-224):this._inRange(l,240,244)&&(n=3,o=65536,r=l-240),r*=Math.pow(64,n),e=null);else if(this._inRange(l,128,191))if(s+=1,r+=(l-128)*Math.pow(64,n-s),s!==n)e=null;else{var h=r,u=o;o=s=n=r=0,e=this._inRange(h,u,1114111)&&!this._inRange(h,55296,57343)?h:l}else o=s=n=r=0,a--,e=l;null!==e&&-1!==e&&(e<=65535?0<e&&(i+=String.fromCharCode(e)):(e-=65536,i+=String.fromCharCode(55296+(e>>10&1023)),i+=String.fromCharCode(56320+(1023&e))))}return i},t.prototype._getUTF16Key=function(t){for(var e=0,a=t.length;e<a;++e)if(255<t.charCodeAt(e))return encodeURI(t);return t},t.prototype._parseBinaryTimeline=function(t,e,a){void 0===a&&(a=null);var i=null!==a?a:z.BaseObject.borrowObject(z.TimelineData);i.type=t,i.offset=e,this._timeline=i;var r=this._timelineArrayBuffer[i.offset+2];if(1===r)i.frameIndicesOffset=-1;else{var n=0,s=this._animation.frameCount+1,o=this._data.frameIndices;z.DragonBones.webAssembly?(n=o.size(),o.resize(n+s,0)):(n=o.length,o.length+=s),i.frameIndicesOffset=n;for(var l=0,h=0,u=0,_=0;l<s;++l)u+_<=l&&h<r&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[i.offset+5+h]],_=h===r-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[i.offset+5+h+1]]-u,h++),z.DragonBones.webAssembly?o.set(n+l,h-1):o[n+l]=h-1}return this._timeline=null,i},t.prototype._parseMesh=function(t,e){e.offset=t[z.DataParser.OFFSET];var a=this._intArrayBuffer[e.offset+3];if(0<=a){var i=z.BaseObject.borrowObject(z.WeightData),r=this._intArrayBuffer[e.offset+0],n=this._intArrayBuffer[a+0];i.offset=a;for(var s=0;s<n;++s){var o=this._intArrayBuffer[a+2+s];i.addBone(this._rawBones[o])}for(var l=a+2+n,h=0,u=(s=0,r);s<u;++s){var _=this._intArrayBuffer[l++];h+=_,l+=_}i.count=h,e.weight=i}},t.prototype._parseAnimation=function(t){var e=z.BaseObject.borrowObject(z.AnimationData);e.frameCount=Math.max(z.ObjectDataParser._getNumber(t,z.DataParser.DURATION,1),1),e.playTimes=z.ObjectDataParser._getNumber(t,z.DataParser.PLAY_TIMES,1),e.duration=e.frameCount/this._armature.frameRate,e.fadeInTime=z.ObjectDataParser._getNumber(t,z.DataParser.FADE_IN_TIME,0),e.scale=z.ObjectDataParser._getNumber(t,z.DataParser.SCALE,1),e.name=z.ObjectDataParser._getString(t,z.DataParser.NAME,z.DataParser.DEFAULT_NAME),0===e.name.length&&(e.name=z.DataParser.DEFAULT_NAME);var a=t[z.DataParser.OFFSET];if(e.frameIntOffset=a[0],e.frameFloatOffset=a[1],e.frameOffset=a[2],this._animation=e,z.DataParser.ACTION in t&&(e.actionTimeline=this._parseBinaryTimeline(0,t[z.DataParser.ACTION])),z.DataParser.Z_ORDER in t&&(e.zOrderTimeline=this._parseBinaryTimeline(1,t[z.DataParser.Z_ORDER])),z.DataParser.BONE in t){var i=t[z.DataParser.BONE];for(var r in i){var n=i[r];z.DragonBones.webAssembly&&(r=this._getUTF16Key(r));var s=this._armature.getBone(r);if(null!==s)for(var o=0,l=n.length;o<l;o+=2){var h=n[o],u=n[o+1],_=this._parseBinaryTimeline(h,u);this._animation.addBoneTimeline(s,_)}}}if(z.DataParser.SURFACE in t){i=t[z.DataParser.SURFACE];for(var r in i){n=i[r];z.DragonBones.webAssembly&&(r=this._getUTF16Key(r));var f=this._armature.getBone(r);if(null!==f)for(o=0,l=n.length;o<l;o+=2){h=n[o],u=n[o+1],_=this._parseBinaryTimeline(h,u);this._animation.addSurfaceTimeline(f,_)}}}if(z.DataParser.SLOT in t){i=t[z.DataParser.SLOT];for(var r in i){n=i[r];z.DragonBones.webAssembly&&(r=this._getUTF16Key(r));var m=this._armature.getSlot(r);if(null!==m)for(o=0,l=n.length;o<l;o+=2){h=n[o],u=n[o+1],_=this._parseBinaryTimeline(h,u);this._animation.addSlotTimeline(m,_)}}}if(z.DataParser.CONSTRAINT in t){i=t[z.DataParser.CONSTRAINT];for(var r in i){n=i[r];z.DragonBones.webAssembly&&(r=this._getUTF16Key(r));var c=this._armature.getConstraint(r);if(null!==c)for(o=0,l=n.length;o<l;o+=2){h=n[o],u=n[o+1],_=this._parseBinaryTimeline(h,u);this._animation.addConstraintTimeline(c,_)}}}if(z.DataParser.ANIMATION in t){i=t[z.DataParser.ANIMATION];for(var r in i){n=i[r];z.DragonBones.webAssembly&&(r=this._getUTF16Key(r));for(o=0,l=n.length;o<l;o+=2){h=n[o],u=n[o+1],_=this._parseBinaryTimeline(h,u);this._animation.addAnimationTimeline(r,_)}}}return this._animation=null,e},t.prototype._parseArray=function(t){var e=t[z.DataParser.OFFSET],a=e[1],i=e[3],r=e[5],n=e[7],s=e[9],o=e[11],l=new Int16Array(this._binary,this._binaryOffset+e[0],a/Int16Array.BYTES_PER_ELEMENT),h=new Float32Array(this._binary,this._binaryOffset+e[2],i/Float32Array.BYTES_PER_ELEMENT),u=new Int16Array(this._binary,this._binaryOffset+e[4],r/Int16Array.BYTES_PER_ELEMENT),_=new Float32Array(this._binary,this._binaryOffset+e[6],n/Float32Array.BYTES_PER_ELEMENT),f=new Int16Array(this._binary,this._binaryOffset+e[8],s/Int16Array.BYTES_PER_ELEMENT),m=new Uint16Array(this._binary,this._binaryOffset+e[10],o/Uint16Array.BYTES_PER_ELEMENT);if(z.DragonBones.webAssembly){for(var c=a+i+r+n+s+o,p=z.webAssemblyModule._malloc(c),d=new Uint8Array(this._binary,this._binaryOffset,c/Uint8Array.BYTES_PER_ELEMENT),y=new Uint8Array(z.webAssemblyModule.HEAP16.buffer,p,d.length),g=0,D=d.length;g<D;++g)y[g]=d[g];z.webAssemblyModule.setDataBinary(this._data,p,a,i,r,n,s,o),this._intArrayBuffer=l,this._floatArrayBuffer=h,this._frameIntArrayBuffer=u,this._frameFloatArrayBuffer=_,this._frameArrayBuffer=f,this._timelineArrayBuffer=m}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=h,this._data.frameIntArray=this._frameIntArrayBuffer=u,this._data.frameFloatArray=this._frameFloatArrayBuffer=_,this._data.frameArray=this._frameArrayBuffer=f,this._data.timelineArray=this._timelineArrayBuffer=m},t.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var a=new Uint8Array(t,0,8);if(a[0]!=="D".charCodeAt(0)||a[1]!=="B".charCodeAt(0)||a[2]!=="D".charCodeAt(0)||a[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var i=new Uint32Array(t,8,1)[0],r=new Uint8Array(t,12,i),n=this._decodeUTF8(r),s=JSON.parse(n);return this._binaryOffset=12+i,this._binary=t,o.prototype.parseDragonBonesData.call(this,s,e)},t.getInstance=function(){return null===t._binaryDataParserInstance&&(t._binaryDataParserInstance=new t),t._binaryDataParserInstance},t._binaryDataParserInstance=null,t}(z.ObjectDataParser),z.BinaryDataParser=K,function(y){var t=function(){function s(t){void 0===t&&(t=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,(this._dataParser=null)===s._objectParser&&(s._objectParser=new y.ObjectDataParser),null===s._binaryParser&&(s._binaryParser=new y.BinaryDataParser),this._dataParser=null!==t?t:s._objectParser}return s.prototype._isSupportMesh=function(){return!0},s.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var a=0,i=this._textureAtlasDataMap[t];a<i.length;a++){if(null!==(l=(o=i[a]).getTexture(e)))return l}if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var n=0,s=this._textureAtlasDataMap[r];n<s.length;n++){var o,l;if((o=s[n]).autoSearch)if(null!==(l=o.getTexture(e)))return l}return null},s.prototype._fillBuildArmaturePackage=function(t,e,a,i,r){var n=null,s=null;if(0<e.length&&e in this._dragonBonesDataMap&&(s=(n=this._dragonBonesDataMap[e]).getArmature(a)),null===s&&(0===e.length||this.autoSearch))for(var o in this._dragonBonesDataMap)if(n=this._dragonBonesDataMap[o],(0===e.length||n.autoSearch)&&null!==(s=n.getArmature(a))){e=o;break}if(null!==s){if(t.dataName=e,t.textureAtlasName=r,t.data=n,t.armature=s,t.skin=null,0<i.length&&(t.skin=s.getSkin(i),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var l=this._dragonBonesDataMap[o].getArmature(i);if(null!==l){t.skin=l.defaultSkin;break}}return null===t.skin&&(t.skin=s.defaultSkin),!0}return!1},s.prototype._buildBones=function(t,e){for(var a=0,i=t.armature.sortedBones;a<i.length;a++){var r=i[a],n=y.BaseObject.borrowObject(0===r.type?y.Bone:y.Surface);n.init(r),null!==r.parent?e.addBone(n,r.parent.name):e.addBone(n,"")}var s=t.armature.constraints;for(var o in s){var l=s[o],h=y.BaseObject.borrowObject(y.IKConstraint);h.init(l,e),e.addConstraint(h)}},s.prototype._buildSlots=function(t,e){var a=t.skin,i=t.armature.defaultSkin;if(null!==a&&null!==i){var r={};for(var n in i.displays){var s=i.getDisplays(n);r[n]=s}if(a!==i)for(var n in a.displays){s=a.getDisplays(n);r[n]=s}for(var o=0,l=t.armature.sortedSlots;o<l.length;o++){var h=l[o],u=(s=h.name in r?r[h.name]:null,this._buildSlot(t,h,s,e));if(e.addSlot(u,h.parent.name),null!==s){for(var _=new Array,f=0,m=y.DragonBones.webAssembly?s.size():s.length;f<m;++f){var c=y.DragonBones.webAssembly?s.get(f):s[f];null!==c?_.push(this._getSlotDisplay(t,c,null,u)):_.push(null)}u._setDisplayList(_)}u._setDisplayIndex(h.displayIndex,!0)}}},s.prototype._buildChildArmature=function(t,e,a){return this.buildArmature(a.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},s.prototype._getSlotDisplay=function(t,e,a,i){var r=null!==t?t.dataName:e.parent.parent.parent.name,n=null;switch(e.type){case 0:var s=e;null===s.texture?s.texture=this._getTextureData(r,e.path):null!==t&&0<t.textureAtlasName.length&&(s.texture=this._getTextureData(t.textureAtlasName,e.path)),n=null!==a&&2===a.type&&this._isSupportMesh()?i.meshDisplay:i.rawDisplay;break;case 2:var o=e;null===o.texture?o.texture=this._getTextureData(r,o.path):null!==t&&0<t.textureAtlasName.length&&(o.texture=this._getTextureData(t.textureAtlasName,o.path)),n=this._isSupportMesh()?i.meshDisplay:i.rawDisplay;break;case 1:var l=e,h=this._buildChildArmature(t,i,e);if(null!==h){if(h.inheritAnimation=l.inheritAnimation,!h.inheritAnimation){var u=0<l.actions.length?l.actions:h.armatureData.defaultActions;if(0<u.length)for(var _=0,f=u;_<f.length;_++){var m=f[_];h._bufferAction(m,!0)}else h.animation.play()}l.armature=h.armatureData}n=h}return n},s.prototype.parseDragonBonesData=function(t,e,a){void 0===e&&(e=null),void 0===a&&(a=1);for(var i=t instanceof ArrayBuffer?s._binaryParser:this._dataParser,r=i.parseDragonBonesData(t,a);;){var n=this._buildTextureAtlasData(null,null);if(!i.parseTextureAtlasData(null,n,a)){n.returnToPool();break}this.addTextureAtlasData(n,e)}return null!==r&&this.addDragonBonesData(r,e),r},s.prototype.parseTextureAtlasData=function(t,e,a,i){void 0===a&&(a=null),void 0===i&&(i=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,i),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,a),r},s.prototype.updateTextureAtlasData=function(t,e){var a=this.getTextureAtlasData(t);if(null!==a)for(var i=0,r=a.length;i<r;++i)i<e.length&&this._buildTextureAtlasData(a[i],e[i])},s.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},s.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},s.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},s.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},s.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var a=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];a.indexOf(t)<0&&a.push(t)},s.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var a=this._textureAtlasDataMap[t];if(e)for(var i=0,r=a;i<r.length;i++){var n=r[i];this._dragonBones.bufferObject(n)}delete this._textureAtlasDataMap[t]}},s.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var a=new o;return this._fillBuildArmaturePackage(a,e,t,"","")?a.armature:null},s.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var a=0,i=this._textureAtlasDataMap[e];a<i.length;a++){var r=i[a];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},s.prototype.buildArmature=function(t,e,a,i){void 0===e&&(e=""),void 0===a&&(a=""),void 0===i&&(i="");var r=new o;if(!this._fillBuildArmaturePackage(r,e||"",t,a||"",i||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var n=this._buildArmature(r);return this._buildBones(r,n),this._buildSlots(r,n),n.invalidUpdate(null,!0),n.advanceTime(0),n},s.prototype.replaceDisplay=function(t,e,a){void 0===a&&(a=-1),a<0&&(a=t.displayIndex),a<0&&(a=0),t.replaceDisplayData(e,a);var i=t.displayList;if(i.length<=a){i.length=a+1;for(var r=0,n=i.length;r<n;++r)i[r]||(i[r]=null)}if(null!==e){var s=t.rawDisplayDatas,o=null;s&&(y.DragonBones.webAssembly?a<s.size()&&(o=s.get(a)):a<s.length&&(o=s[a])),i[a]=this._getSlotDisplay(null,e,o,t)}else i[a]=null;t.displayList=i},s.prototype.replaceSlotDisplay=function(t,e,a,i,r,n){void 0===n&&(n=-1);var s=this.getArmatureData(e,t||"");if(!s||!s.defaultSkin)return!1;var o=s.defaultSkin.getDisplay(a,i);return!!o&&(this.replaceDisplay(r,o,n),!0)},s.prototype.replaceSlotDisplayList=function(t,e,a,i){var r=this.getArmatureData(e,t||"");if(!r||!r.defaultSkin)return!1;var n=r.defaultSkin.getDisplays(a);if(!n)return!1;for(var s=0,o=0,l=y.DragonBones.webAssembly?n.size():n.length;o<l;++o){var h=y.DragonBones.webAssembly?n.get(o):n[o];this.replaceDisplay(i,h,s++)}return!0},s.prototype.replaceSkin=function(t,e,a,i){void 0===a&&(a=!1),void 0===i&&(i=null);for(var r=!1,n=e.parent.defaultSkin,s=0,o=t.getSlots();s<o.length;s++){var l=o[s];if(!(null!==i&&0<=i.indexOf(l.name))){var h=e.getDisplays(l.name);if(h||(null!==n&&e!==n&&(h=n.getDisplays(l.name)),h)){for(var u=y.DragonBones.webAssembly?h.size():h.length,_=l.displayList,f=0,m=_.length=u;f<m;++f){var c=y.DragonBones.webAssembly?h.get(f):h[f];_[f]=null!==c?this._getSlotDisplay(null,c,null,l):null}r=!0,l.rawDisplayDatas=h,l.displayList=_}else a&&(l.rawDisplayDatas=null,l.displayList=[])}}return r},s.prototype.replaceAnimation=function(t,e,a){void 0===a&&(a=!0);var i=e.defaultSkin;if(null===i)return!1;if(a)t.animation.animations=e.animations;else{var r=t.animation.animations,n={};for(var s in r)n[s]=r[s];for(var s in e.animations)n[s]=e.animations[s];t.animation.animations=n}for(var o=0,l=t.getSlots();o<l.length;o++)for(var h=l[o],u=0,_=0,f=h.displayList;_<f.length;_++){var m=f[_];if(m instanceof y.Armature){var c=i.getDisplays(h.name);if(null!==c&&u<(y.DragonBones.webAssembly?c.size():c.length)){var p=y.DragonBones.webAssembly?c.get(u):c[u];if(null!==p&&1===p.type){var d=this.getArmatureData(p.path,p.parent.parent.parent.name);d&&this.replaceAnimation(m,d,a)}}}u++}return!0},s.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},s.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(s.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),s.prototype.changeSkin=function(t,e,a){return void 0===a&&(a=null),this.replaceSkin(t,e,!1,a)},s.prototype.copyAnimationsToArmature=function(t,e,a,i,r){void 0===a&&(a=""),void 0===i&&(i=""),void 0===r&&(r=!0);var n=this.getArmatureData(e,i);return!!n&&this.replaceAnimation(t,n,r)},s._objectParser=null,s._binaryParser=null,s}();y.BaseFactory=t;var o=function(){this.dataName="",this.textureAtlasName="",this.skin=null};y.BuildArmaturePackage=o}(it||(it={})),function(a){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this._renderTexture,this._renderTexture=null},t.prototype.createTexture=function(){return a.BaseObject.borrowObject(i)},Object.defineProperty(t.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(this._renderTexture!==t)if(this._renderTexture=t,null!==this._renderTexture)for(var e in this.textures){(a=this.textures[e]).renderTexture=new PIXI.Texture(this._renderTexture,a.region,a.region,new PIXI.Rectangle(0,0,a.region.width,a.region.height))}else for(var e in this.textures){var a;(a=this.textures[e]).renderTexture=null}},enumerable:!0,configurable:!0}),t}(a.TextureAtlasData);a.PhaserTextureAtlasData=t;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderTexture=null,t}return ot(t,e),t.toString=function(){return"[class dragonBones.PhaserTextureData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(!1),this.renderTexture=null},t}(a.TextureData);a.PhaserTextureData=i}(it||(it={})),Z=it||(it={}),q=function(a){function t(){var t=a.call(this,Z.PhaserFactory._game,0,0)||this;return t.debugDraw=!1,t._debugDraw=!1,t._armature=null,t._signals={},t._debugDrawer=null,t}return ot(t,a),t.prototype._getChildByName=function(t,e){for(var a=0,i=t.children;a<i.length;a++){var r=i[a];if(r.name===e)return r}return null},t.prototype.dbInit=function(t){this._armature=t},t.prototype.dbClear=function(){for(var t in this._signals){var e=this._signals[t];e.removeAll(),e.dispose(),delete this._signals[t]}this._debugDrawer,a.prototype.destroy.call(this,!1)},t.prototype.dbUpdate=function(){var t=Z.DragonBones.debugDraw||this.debugDraw;if(t||this._debugDraw)if(this._debugDraw=t,this._debugDraw){if(null===this._debugDrawer){this._debugDrawer=new Phaser.Sprite(this.game,0,0);var e=new Phaser.Graphics(this.game);this._debugDrawer.addChild(e)}this.addChild(this._debugDrawer);var a=this._debugDrawer.getChildAt(0);a.clear();for(var i=this._armature.getBones(),r=0,n=i.length;r<n;++r){var s=i[r],o=s.boneData.length,l=s.globalTransformMatrix.tx,h=s.globalTransformMatrix.ty,u=l+s.globalTransformMatrix.a*o,_=h+s.globalTransformMatrix.b*o;a.lineStyle(2,65535,.7),a.moveTo(l,h),a.lineTo(u,_),a.lineStyle(0,0,0),a.beginFill(65535,.7),a.drawCircle(l,h,3),a.endFill()}var f=this._armature.getSlots();for(r=0,n=f.length;r<n;++r){var m=f[r],c=m.boundingBoxData;if(c){switch((b=this._getChildByName(this._debugDrawer,m.name))||((b=new Phaser.Graphics(this.game)).name=m.name,this._debugDrawer.addChild(b)),b.clear(),b.lineStyle(2,16711935,.7),c.type){case 0:b.drawRect(.5*-c.width,.5*-c.height,c.width,c.height);break;case 1:b.drawEllipse(.5*-c.width,.5*-c.height,c.width,c.height);break;case 2:for(var p=c.vertices,d=0,y=p.length;d<y;d+=2){var g=p[d],D=p[d+1];0===d?b.moveTo(g,D):b.lineTo(g,D)}b.lineTo(p[0],p[1])}b.endFill(),m.updateTransformAndMatrix(),m.updateGlobalTransform();var v=m.global;b.x=v.x,b.y=v.y,b.rotation=v.rotation,b.scale.x=v.scaleX,b.scale.y=v.scaleY,b.pivot.x=m._pivotX,b.pivot.y=m._pivotY}else{var b;(b=this._getChildByName(this._debugDrawer,m.name))&&this._debugDrawer.removeChild(b)}}}else null!==this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},t.prototype.dispose=function(t){void 0===t&&(t=!0),null!==this._armature&&(this._armature.dispose(),this._armature=null)},t.prototype.destroy=function(){this.dispose();var t=Z.PhaserFactory._armatureDisplays.indexOf(this);Z.PhaserFactory._armatureDisplays.splice(t,1)},t.prototype.dispatchDBEvent=function(t,e){t in this._signals||(this._signals[t]=new Phaser.Signal),this._signals[t].dispatch(e)},t.prototype.hasDBEventListener=function(t){return t in this._signals&&0<this._signals[t].getNumListeners()},t.prototype.addDBEventListener=function(t,e,a){t in this._signals||(this._signals[t]=new Phaser.Signal),this._signals[t].add(e,a)},t.prototype.removeDBEventListener=function(t,e,a){t in this._signals&&this._signals[t].remove(e,a)},Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),t.prototype.hasEvent=function(t){return this.hasDBEventListener(t)},t.prototype.addEvent=function(t,e,a){this.addDBEventListener(t,e,a)},t.prototype.removeEvent=function(t,e,a){this.removeDBEventListener(t,e,a)},t}(Phaser.Sprite),Z.PhaserArmatureDisplay=q,Q=it||(it={}),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.toString=function(){return"[class dragonBones.PhaserSlot]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay=null},e.prototype._initDisplay=function(t,e){},e.prototype._disposeDisplay=function(t,e){e||t.destroy(!0)},e.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},e.prototype._addDisplay=function(){this._armature.display.addChild(this._renderDisplay)},e.prototype._replaceDisplay=function(t){var e=this._armature.display,a=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,a),e.removeChild(a),this._textureScale=1},e.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},e.prototype._updateZOrder=function(){var t=this._armature.display;t.getChildIndex(this._renderDisplay)!==this._zOrder&&t.addChildAt(this._renderDisplay,this._zOrder)},e.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible&&this._visible},e.prototype._updateBlendMode=function(){if(this._renderDisplay instanceof PIXI.Sprite)switch(this._blendMode){case 0:this._renderDisplay.blendMode=PIXI.blendModes.NORMAL;break;case 1:this._renderDisplay.blendMode=PIXI.blendModes.ADD;break;case 3:this._renderDisplay.blendMode=PIXI.blendModes.DARKEN;break;case 4:this._renderDisplay.blendMode=PIXI.blendModes.DIFFERENCE;break;case 6:this._renderDisplay.blendMode=PIXI.blendModes.HARD_LIGHT;break;case 9:this._renderDisplay.blendMode=PIXI.blendModes.LIGHTEN;break;case 10:this._renderDisplay.blendMode=PIXI.blendModes.MULTIPLY;break;case 11:this._renderDisplay.blendMode=PIXI.blendModes.OVERLAY;break;case 12:this._renderDisplay.blendMode=PIXI.blendModes.SCREEN}},e.prototype._updateColor=function(){if(this._renderDisplay.alpha=this._colorTransform.alphaMultiplier,this._renderDisplay instanceof PIXI.Sprite){var t=(Math.round(255*this._colorTransform.redMultiplier)<<16)+(Math.round(255*this._colorTransform.greenMultiplier)<<8)+Math.round(255*this._colorTransform.blueMultiplier);this._renderDisplay.tint=t}},e.prototype._updateFrame=function(){var t=this._display===this._meshDisplay?this._meshData:null,e=this._textureData;if(0<=this._displayIndex&&null!==this._display&&null!==e){var a=e.parent;null!==this._armature.replacedTexture&&null!==this._rawDisplayDatas&&0<=this._rawDisplayDatas.indexOf(this._displayData)&&(null===this._armature._replaceTextureAtlasData?((a=Q.BaseObject.borrowObject(Q.PhaserTextureAtlasData)).copyFrom(e.parent),a.renderTexture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=a):a=this._armature._replaceTextureAtlasData,e=a.getTexture(e.name));var i=e.renderTexture;if(null!==i){if(null!==t){var r=t.parent.parent.parent,n=r.intArray,s=r.floatArray,o=n[t.offset+0],l=n[t.offset+1],h=n[t.offset+2];h<0&&(h+=65536);var u=h+2*o,_=this._renderDisplay,f=0<a.width?a.width:i.width,m=0<a.height?a.height:i.height;_.uvs=new Float32Array(2*o),_.vertices=new Float32Array(2*o),_.indices=new Int16Array(3*l);for(var c=0,p=2*o;c<p;++c)_.vertices[c]=s[h+c],_.uvs[c]=s[u+c];for(c=0;c<3*l;++c)_.indices[c]=n[t.offset+4+c];for(c=0,p=_.uvs.length;c<p;c+=2){var d=_.uvs[c],y=_.uvs[c+1];e.rotated?(_.uvs[c]=(e.region.x+(1-y)*e.region.width)/f,_.uvs[c+1]=(e.region.y+d*e.region.height)/m):(_.uvs[c]=(e.region.x+d*e.region.width)/f,_.uvs[c+1]=(e.region.y+y*e.region.height)/m)}_.texture=e.renderTexture}else{var g;this._textureScale=e.parent.scale*this._armature._armatureData.scale,(g=this._renderDisplay).setTexture(i)}return void(this._visibleDirty=!0)}}(g=this._renderDisplay).x=0,g.y=0,g.visible=!1},e.prototype._updateMesh=function(){var t=this._armature._armatureData.scale,e=this._meshData,a=0<this._deformVertices.length&&e.inheritDeform,i=e.weight,r=this._renderDisplay;if(null!==i){var n=(P=e.parent.parent.parent).intArray,s=P.floatArray,o=n[e.offset+0],l=n[i.offset+1];l<0&&(l+=65536);for(var h=0,u=0,_=i.offset+2+i.bones.length,f=l,m=0;h<o;++h){for(var c=n[_++],p=0,d=0,y=0;y<c;++y){var g=n[_++],D=this._meshBones[g];if(null!==D){var v=D.globalTransformMatrix,b=s[f++],T=s[f++]*t,A=s[f++]*t;a&&(T+=this._deformVertices[m++],A+=this._deformVertices[m++]),p+=(v.a*T+v.c*A+v.tx)*b,d+=(v.b*T+v.d*A+v.ty)*b}}r.vertices[u++]=p,r.vertices[u++]=d}}else if(a){var P,S=0!==this._parent._boneData.type,x=(n=(P=e.parent.parent.parent).intArray,s=P.floatArray,o=n[e.offset+0],n[e.offset+2]);x<0&&(x+=65536);h=0;for(var O=2*o;h<O;h+=2){var M=s[x+h]*t+this._deformVertices[h],w=s[x+h+1]*t+this._deformVertices[h+1];if(S){v=this._parent._getGlobalTransformMatrix(M,w);r.vertices[h]=v.a*M+v.c*w+v.tx,r.vertices[h+1]=v.b*M+v.d*w+v.ty}else r.vertices[h]=M,r.vertices[h+1]=w}}},e.prototype._updateGlueMesh=function(){},e.prototype._updateTransform=function(){this.updateGlobalTransform();var t=this.global;if(this._renderDisplay!==this._rawDisplay&&this._renderDisplay!==this._meshDisplay||this._renderDisplay._rawScale)this._renderDisplay.x=t.x,this._renderDisplay.y=t.y;else{var e=t.x-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),a=t.y-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY);this._renderDisplay.x=e,this._renderDisplay.y=a}this._renderDisplay.rotation=t.rotation,this._renderDisplay.skew=t.skew;var i=new Phaser.Point(1,1);this._renderDisplay._replacePivot&&(this._renderDisplay.pivot=this._renderDisplay._replacePivot),this._renderDisplay._rawScale&&(i=this._renderDisplay._rawScale),this._renderDisplay.scale.x=i.x*t.scaleX*this._textureScale,this._renderDisplay.scale.y=i.y*t.scaleY*this._textureScale},e.prototype._identityTransform=function(){this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.rotation=0,this._renderDisplay.skew=0,this._renderDisplay.scale.x=1,this._renderDisplay.scale.y=1},e}(Q.Slot),Q.PhaserSlot=J,$=it||(it={}),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ot(e,t),e.prototype.updateTransform=function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var a,i,r,n,s,o,l=e.worldTransform,h=this.worldTransform;if(this.rotation%Phaser.Math.PI2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var u=this.skew%$.Transform.PI_D;.01<u||u<-.01?(a=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-Math.sin(u+this.rotation)*this.scale.y,n=Math.cos(u+this.rotation)*this.scale.y):(a=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,n=this._cr*this.scale.y),s=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*a+this.pivot.y*r,o-=this.pivot.x*i+this.pivot.y*n),h.a=a*l.a+i*l.c,h.b=a*l.b+i*l.d,h.c=r*l.a+n*l.c,h.d=r*l.b+n*l.d,h.tx=s*l.a+o*l.c+l.tx,h.ty=s*l.b+o*l.d+l.ty}else a=this.scale.x,r=i=0,n=this.scale.y,s=this.position.x-this.pivot.x*a,o=this.position.y-this.pivot.y*n,h.a=a*l.a,h.b=a*l.b,h.c=n*l.c,h.d=n*l.d,h.tx=s*l.a+o*l.c+l.tx,h.ty=s*l.b+o*l.d+l.ty;a=h.a,i=h.b,r=h.c;var _=a*(n=h.d)-i*r;if(a||i){var f=Math.sqrt(a*a+i*i);this.worldRotation=0<i?Math.acos(a/f):-Math.acos(a/f),this.worldScale.x=f,this.worldScale.y=_/f}else if(r||n){var m=Math.sqrt(r*r+n*n);this.worldRotation=Phaser.Math.HALF_PI-(0<n?Math.acos(-r/m):-Math.acos(r/m)),this.worldScale.x=_/m,this.worldScale.y=m}else this.worldScale.x=0,this.worldScale.y=0;return this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.x=h.tx,this.worldPosition.y=h.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,h,l),this},e}(Phaser.Image),$.PhaserSlotDisplay=tt,et=it||(it={}),at=function(s){function t(t,e,a,i,r){var n=s.call(this,t,e,a,i,r)||this;return n.uvs=new Float32Array(10),n.vertices=new Float32Array(10),n.indices=new Int16Array(10),n}return ot(t,s),t.prototype.updateTransform=function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var a,i,r,n,s,o,l=e.worldTransform,h=this.worldTransform;if(this.rotation%Phaser.Math.PI2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var u=this.skew%et.Transform.PI_D;.01<u||u<-.01?(a=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-Math.sin(u+this.rotation)*this.scale.y,n=Math.cos(u+this.rotation)*this.scale.y):(a=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,n=this._cr*this.scale.y),s=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*a+this.pivot.y*r,o-=this.pivot.x*i+this.pivot.y*n),h.a=a*l.a+i*l.c,h.b=a*l.b+i*l.d,h.c=r*l.a+n*l.c,h.d=r*l.b+n*l.d,h.tx=s*l.a+o*l.c+l.tx,h.ty=s*l.b+o*l.d+l.ty}else a=this.scale.x,r=i=0,n=this.scale.y,s=this.position.x-this.pivot.x*a,o=this.position.y-this.pivot.y*n,h.a=a*l.a,h.b=a*l.b,h.c=n*l.c,h.d=n*l.d,h.tx=s*l.a+o*l.c+l.tx,h.ty=s*l.b+o*l.d+l.ty;a=h.a,i=h.b,r=h.c;var _=a*(n=h.d)-i*r;if(a||i){var f=Math.sqrt(a*a+i*i);this.worldRotation=0<i?Math.acos(a/f):-Math.acos(a/f),this.worldScale.x=f,this.worldScale.y=_/f}else if(r||n){var m=Math.sqrt(r*r+n*n);this.worldRotation=Phaser.Math.HALF_PI-(0<n?Math.acos(-r/m):-Math.acos(r/m)),this.worldScale.x=_/m,this.worldScale.y=m}else this.worldScale.x=0,this.worldScale.y=0;return this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.x=h.tx,this.worldPosition.y=h.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,h,l),this},t}(Phaser.BaseMesh),et.PhaserSlotMeshDisplay=at,rt=it||(it={}),nt=function(a){function o(t){void 0===t&&(t=null);var e=a.call(this,t)||this;return e._dragonBones=o._dragonBonesInstance,e}return ot(o,a),o.init=function(t){if(null===o._game){o._game=t;var e=new rt.PhaserArmatureDisplay;o._dragonBonesInstance=new rt.DragonBones(e),o._armatureDisplays=new Array}},Object.defineProperty(o,"factory",{get:function(){return null===o._factory&&(o._factory=new o),o._factory},enumerable:!0,configurable:!0}),o.prototype._isSupportMesh=function(){return console.warn("Phaser-ce can not support mesh."),!0},o.prototype._buildTextureAtlasData=function(t,e){return t?t.renderTexture=e:t=rt.BaseObject.borrowObject(rt.PhaserTextureAtlasData),t},o.prototype._buildArmature=function(t){var e=rt.BaseObject.borrowObject(rt.Armature),a=new rt.PhaserArmatureDisplay;return o._armatureDisplays.push(a),e.init(t.armature,a,a,this._dragonBones),e},o.prototype._buildSlot=function(t,e,a,i){var r=rt.BaseObject.borrowObject(rt.PhaserSlot),n=new rt.PhaserSlotDisplay(o._game,0,0,Phaser.Cache.DEFAULT),s=new rt.PhaserSlotMeshDisplay(o._game,0,0,Phaser.Cache.DEFAULT);return r.init(e,a,n,s),r},o.prototype.buildArmatureDisplay=function(t,e,a,i){void 0===e&&(e=""),void 0===a&&(a=""),void 0===i&&(i="");var r=this.buildArmature(t,e||"",a||"",i||"");return null!==r?(this._dragonBones.clock.add(r),r.display):null},o.prototype.getAllArmatureDisplays=function(){return o._armatureDisplays},o.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var a=this._getTextureData(null!==e?e:"",t);return null!==a&&null!==a.renderTexture?new Phaser.Sprite(o._game,0,0):null},Object.defineProperty(o.prototype,"soundEventManager",{get:function(){return this._dragonBones.eventManager},enumerable:!0,configurable:!0}),o.prototype.replaceSlotMeshDisplay=function(t,e){var a=t.texture._uvs.x0,i=t.texture._uvs.y0,r=t.texture._uvs.x2-a,n=t.texture._uvs.y2-i,s=e.texture._uvs.x0,o=e.texture._uvs.y0,l=(e.texture._uvs.x2-s)/r,h=(e.texture._uvs.y2-o)/n,u=new rt.Matrix(l,0,0,h,(s-a)*l,(o-i)*h);t.texture=e.texture,t._orig_uvs=t.uvs.slice(0);for(var _=0;_<t.uvs.length/2;++_){var f={x:t.uvs[2*_],y:t.uvs[2*_+1]};u.transformPoint(f.x,f.y,f,!1),t.uvs[2*_]=f.x,t.uvs[2*_+1]=f.y}},o.prototype.replaceImageSlotDisplay=function(t,e){t.texture=e.texture,t._rawScale=e.scale,t._rawPivot=t.pivot,t._replacePivot=e.pivot},o._game=null,o._dragonBonesInstance=null,o._factory=null,o._armatureDisplays=null,o}(rt.BaseFactory),rt.PhaserFactory=nt,"undefined"!=typeof exports?("undefined"!=typeof module&&define.amd&&(exports=module.exports=it),exports.dragonBones=it):"undefined"!=typeof define&&define.amd?define("dragonBones",st.dragonBones=it):st.dragonBones=it,it}).call(this);